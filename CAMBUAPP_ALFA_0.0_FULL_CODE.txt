========================================
 CAMBUAPP ALFA 0.0 - COMPLETE SOURCE CODE
========================================

================================================================
FILE: shared/schema.ts
================================================================
import { sql } from "drizzle-orm";
import { pgTable, text, varchar, integer, boolean, real, uniqueIndex } from "drizzle-orm/pg-core";
import { createInsertSchema } from "drizzle-zod";
import { z } from "zod";

export const users = pgTable("users", {
  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
  username: text("username").notNull().unique(),
  password: text("password").notNull(),
  fullName: text("full_name").notNull(),
  nickname: text("nickname"),
  avatar: text("avatar").default(""),
  bio: text("bio").default(""),
  isIdVerified: boolean("is_id_verified").default(false),
  dob: text("dob"),
  email: text("email").notNull(),
  phone: text("phone").default(""),
  country: text("country").default(""),
  city: text("city").default(""),
  address: text("address").default(""),
  hostRating: real("host_rating").default(0),
  guestRating: real("guest_rating").default(0),
  notificationsEnabled: boolean("notifications_enabled").default(true),
  darkMode: boolean("dark_mode").default(false),
  searchRadius: integer("search_radius").default(50),
});

export const parties = pgTable("parties", {
  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
  hostId: varchar("host_id").notNull().references(() => users.id),
  title: text("title").notNull(),
  theme: text("theme").notNull(),
  description: text("description").notNull(),
  date: text("date").notNull(),
  locationName: text("location_name").notNull(),
  city: text("city").notNull(),
  country: text("country").notNull(),
  exactAddress: text("exact_address"),
  latitude: real("latitude").notNull(),
  longitude: real("longitude").notNull(),
  maxGuests: integer("max_guests").notNull(),
  price: integer("price").default(0),
  whatToBring: text("what_to_bring").array().default(sql`'{}'::text[]`),
  imageUrl: text("image_url").default(""),
  galleryUrls: text("gallery_urls").array().default(sql`'{}'::text[]`),
  includesAlcohol: boolean("includes_alcohol").default(false),
  createdAt: text("created_at").default(sql`now()`),
});

export const partyAttendees = pgTable("party_attendees", {
  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
  partyId: varchar("party_id").notNull().references(() => parties.id),
  userId: varchar("user_id").notNull().references(() => users.id),
}, (table) => [
  uniqueIndex("party_user_unique").on(table.partyId, table.userId),
]);

export const partyRequests = pgTable("party_requests", {
  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
  partyId: varchar("party_id").notNull().references(() => parties.id),
  userId: varchar("user_id").notNull().references(() => users.id),
  message: text("message").default(""),
  pledgedItems: text("pledged_items").default(""),
  status: text("status").notNull().default("pending"),
});

export const reviews = pgTable("reviews", {
  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
  authorId: varchar("author_id").notNull().references(() => users.id),
  targetId: varchar("target_id").notNull().references(() => users.id),
  partyId: varchar("party_id").references(() => parties.id),
  content: text("content").notNull(),
  rating: integer("rating").notNull(),
  type: text("type").notNull(),
  createdAt: text("created_at").default(sql`now()`),
});

export const insertUserSchema = createInsertSchema(users).omit({ id: true });
export type InsertUser = z.infer<typeof insertUserSchema>;
export type User = typeof users.$inferSelect;

export const insertPartySchema = createInsertSchema(parties).omit({ id: true, createdAt: true });
export type InsertParty = z.infer<typeof insertPartySchema>;
export type Party = typeof parties.$inferSelect;

export const insertPartyAttendeeSchema = createInsertSchema(partyAttendees).omit({ id: true });
export type InsertPartyAttendee = z.infer<typeof insertPartyAttendeeSchema>;
export type PartyAttendee = typeof partyAttendees.$inferSelect;

export const insertPartyRequestSchema = createInsertSchema(partyRequests).omit({ id: true });
export type InsertPartyRequest = z.infer<typeof insertPartyRequestSchema>;
export type PartyRequest = typeof partyRequests.$inferSelect;

export const insertReviewSchema = createInsertSchema(reviews).omit({ id: true, createdAt: true });
export type InsertReview = z.infer<typeof insertReviewSchema>;
export type Review = typeof reviews.$inferSelect;


================================================================
FILE: server/storage.ts
================================================================
import {
  type User, type InsertUser,
  type Party, type InsertParty,
  type PartyAttendee, type InsertPartyAttendee,
  type PartyRequest, type InsertPartyRequest,
  type Review, type InsertReview,
  users, parties, partyAttendees, partyRequests, reviews,
} from "@shared/schema";
import { eq, and, count } from "drizzle-orm";
import { drizzle } from "drizzle-orm/node-postgres";
import { Pool } from "pg";
import * as schema from "@shared/schema";

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
export const db = drizzle(pool, { schema });

export interface IStorage {
  getUser(id: string): Promise<User | undefined>;
  getUserByUsername(username: string): Promise<User | undefined>;
  createUser(user: InsertUser): Promise<User>;
  updateUser(id: string, data: Partial<InsertUser>): Promise<User | undefined>;
  getParties(): Promise<Party[]>;
  getPartiesByCity(city: string): Promise<Party[]>;
  getParty(id: string): Promise<Party | undefined>;
  getPartiesByHost(hostId: string): Promise<Party[]>;
  createParty(party: InsertParty): Promise<Party>;
  updateParty(id: string, data: Partial<InsertParty>): Promise<Party | undefined>;
  deleteParty(id: string): Promise<void>;
  getPartyAttendees(partyId: string): Promise<PartyAttendee[]>;
  getAttendeeParties(userId: string): Promise<Party[]>;
  addAttendee(partyId: string, userId: string): Promise<PartyAttendee>;
  removeAttendee(partyId: string, userId: string): Promise<void>;
  getAttendeeCount(partyId: string): Promise<number>;
  getPartyRequests(partyId: string): Promise<PartyRequest[]>;
  getUserRequests(userId: string): Promise<PartyRequest[]>;
  createPartyRequest(request: InsertPartyRequest): Promise<PartyRequest>;
  updateRequestStatus(id: string, status: string): Promise<PartyRequest | undefined>;
  getReviewsByTarget(targetId: string): Promise<Review[]>;
  getReviewsByAuthor(authorId: string): Promise<Review[]>;
  createReview(review: InsertReview): Promise<Review>;
}

export class DatabaseStorage implements IStorage {
  async getUser(id: string): Promise<User | undefined> {
    const [user] = await db.select().from(users).where(eq(users.id, id));
    return user;
  }

  async getUserByUsername(username: string): Promise<User | undefined> {
    const [user] = await db.select().from(users).where(eq(users.username, username));
    return user;
  }

  async createUser(user: InsertUser): Promise<User> {
    const [created] = await db.insert(users).values(user).returning();
    return created;
  }

  async updateUser(id: string, data: Partial<InsertUser>): Promise<User | undefined> {
    const [updated] = await db.update(users).set(data).where(eq(users.id, id)).returning();
    return updated;
  }

  async getParties(): Promise<Party[]> {
    return db.select().from(parties);
  }

  async getPartiesByCity(city: string): Promise<Party[]> {
    return db.select().from(parties).where(eq(parties.city, city));
  }

  async getParty(id: string): Promise<Party | undefined> {
    const [party] = await db.select().from(parties).where(eq(parties.id, id));
    return party;
  }

  async getPartiesByHost(hostId: string): Promise<Party[]> {
    return db.select().from(parties).where(eq(parties.hostId, hostId));
  }

  async createParty(party: InsertParty): Promise<Party> {
    const [created] = await db.insert(parties).values(party).returning();
    return created;
  }

  async updateParty(id: string, data: Partial<InsertParty>): Promise<Party | undefined> {
    const [updated] = await db.update(parties).set(data).where(eq(parties.id, id)).returning();
    return updated;
  }

  async deleteParty(id: string): Promise<void> {
    await db.delete(parties).where(eq(parties.id, id));
  }

  async getPartyAttendees(partyId: string): Promise<PartyAttendee[]> {
    return db.select().from(partyAttendees).where(eq(partyAttendees.partyId, partyId));
  }

  async getAttendeeParties(userId: string): Promise<Party[]> {
    const attendeeRows = await db.select().from(partyAttendees).where(eq(partyAttendees.userId, userId));
    if (attendeeRows.length === 0) return [];
    const partyIds = attendeeRows.map(a => a.partyId);
    const result: Party[] = [];
    for (const pid of partyIds) {
      const [party] = await db.select().from(parties).where(eq(parties.id, pid));
      if (party) result.push(party);
    }
    return result;
  }

  async addAttendee(partyId: string, userId: string): Promise<PartyAttendee> {
    const [created] = await db.insert(partyAttendees).values({ partyId, userId }).returning();
    return created;
  }

  async removeAttendee(partyId: string, userId: string): Promise<void> {
    await db.delete(partyAttendees).where(
      and(eq(partyAttendees.partyId, partyId), eq(partyAttendees.userId, userId))
    );
  }

  async getAttendeeCount(partyId: string): Promise<number> {
    const [result] = await db.select({ count: count() }).from(partyAttendees).where(eq(partyAttendees.partyId, partyId));
    return result?.count ?? 0;
  }

  async getPartyRequests(partyId: string): Promise<PartyRequest[]> {
    return db.select().from(partyRequests).where(eq(partyRequests.partyId, partyId));
  }

  async getUserRequests(userId: string): Promise<PartyRequest[]> {
    return db.select().from(partyRequests).where(eq(partyRequests.userId, userId));
  }

  async createPartyRequest(request: InsertPartyRequest): Promise<PartyRequest> {
    const [created] = await db.insert(partyRequests).values(request).returning();
    return created;
  }

  async updateRequestStatus(id: string, status: string): Promise<PartyRequest | undefined> {
    const [updated] = await db.update(partyRequests).set({ status }).where(eq(partyRequests.id, id)).returning();
    return updated;
  }

  async getReviewsByTarget(targetId: string): Promise<Review[]> {
    return db.select().from(reviews).where(eq(reviews.targetId, targetId));
  }

  async getReviewsByAuthor(authorId: string): Promise<Review[]> {
    return db.select().from(reviews).where(eq(reviews.authorId, authorId));
  }

  async createReview(review: InsertReview): Promise<Review> {
    const [created] = await db.insert(reviews).values(review).returning();
    return created;
  }
}

export const storage = new DatabaseStorage();


================================================================
FILE: server/routes.ts
================================================================
import type { Express } from "express";
import { createServer, type Server } from "http";
import { storage } from "./storage";
import session from "express-session";
import MemoryStore from "memorystore";
import { insertUserSchema, insertPartySchema } from "@shared/schema";

declare module "express-session" {
  interface SessionData {
    userId: string;
  }
}

const SessionStore = MemoryStore(session);

export async function registerRoutes(
  httpServer: Server,
  app: Express
): Promise<Server> {
  app.use(session({
    secret: process.env.SESSION_SECRET || "cambuapp-secret",
    resave: false,
    saveUninitialized: false,
    store: new SessionStore({ checkPeriod: 86400000 }),
    cookie: { maxAge: 24 * 60 * 60 * 1000 }
  }));

  // Auth Routes
  app.post("/api/auth/register", async (req, res) => {
    try {
      const parsed = insertUserSchema.safeParse(req.body);
      if (!parsed.success) {
        return res.status(400).json({ message: "Invalid input", errors: parsed.error.errors });
      }
      const existing = await storage.getUserByUsername(parsed.data.username);
      if (existing) {
        return res.status(409).json({ message: "Username already taken" });
      }
      const user = await storage.createUser(parsed.data);
      req.session.userId = user.id;
      const { password, ...userWithoutPassword } = user;
      return res.status(201).json(userWithoutPassword);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.post("/api/auth/login", async (req, res) => {
    try {
      const { username, password } = req.body;
      if (!username || !password) {
        return res.status(400).json({ message: "Username and password required" });
      }
      const user = await storage.getUserByUsername(username);
      if (!user || user.password !== password) {
        return res.status(401).json({ message: "Invalid credentials" });
      }
      req.session.userId = user.id;
      const { password: _, ...userWithoutPassword } = user;
      return res.json(userWithoutPassword);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/auth/me", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const user = await storage.getUser(req.session.userId);
      if (!user) {
        return res.status(404).json({ message: "User not found" });
      }
      const { password, ...userWithoutPassword } = user;
      return res.json(userWithoutPassword);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.post("/api/auth/logout", (req, res) => {
    req.session.destroy((err) => {
      if (err) {
        return res.status(500).json({ message: "Failed to logout" });
      }
      return res.json({ message: "Logged out" });
    });
  });

  // User Routes
  app.get("/api/users/:id", async (req, res) => {
    try {
      const user = await storage.getUser(req.params.id);
      if (!user) {
        return res.status(404).json({ message: "User not found" });
      }
      const { password, ...userWithoutPassword } = user;
      return res.json(userWithoutPassword);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.patch("/api/users/:id", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      if (req.session.userId !== req.params.id) {
        return res.status(403).json({ message: "Not authorized" });
      }
      const updated = await storage.updateUser(req.params.id, req.body);
      if (!updated) {
        return res.status(404).json({ message: "User not found" });
      }
      const { password, ...userWithoutPassword } = updated;
      return res.json(userWithoutPassword);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/users/:id/reviews", async (req, res) => {
    try {
      const reviews = await storage.getReviewsByTarget(req.params.id);
      return res.json(reviews);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  // Party Routes - specific routes before parameterized routes
  app.get("/api/parties/host/mine", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const myParties = await storage.getPartiesByHost(req.session.userId);
      const enriched = await Promise.all(myParties.map(async (party) => {
        const host = await storage.getUser(party.hostId);
        const attendeeCount = await storage.getAttendeeCount(party.id);
        return {
          ...party,
          hostName: host?.fullName || "Unknown",
          hostAvatar: host?.avatar || "",
          hostVerified: host?.isIdVerified || false,
          attendeeCount,
        };
      }));
      return res.json(enriched);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/parties/attending/mine", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const attendingParties = await storage.getAttendeeParties(req.session.userId);
      const enriched = await Promise.all(attendingParties.map(async (party) => {
        const host = await storage.getUser(party.hostId);
        const attendeeCount = await storage.getAttendeeCount(party.id);
        return {
          ...party,
          hostName: host?.fullName || "Unknown",
          hostAvatar: host?.avatar || "",
          hostVerified: host?.isIdVerified || false,
          attendeeCount,
        };
      }));
      return res.json(enriched);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/parties", async (req, res) => {
    try {
      const city = req.query.city as string | undefined;
      const allParties = city ? await storage.getPartiesByCity(city) : await storage.getParties();

      const enriched = await Promise.all(allParties.map(async (party) => {
        const host = await storage.getUser(party.hostId);
        const attendeeCount = await storage.getAttendeeCount(party.id);
        return {
          ...party,
          hostName: host?.fullName || "Unknown",
          hostAvatar: host?.avatar || "",
          hostVerified: host?.isIdVerified || false,
          attendeeCount,
        };
      }));

      return res.json(enriched);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/parties/:id", async (req, res) => {
    try {
      const party = await storage.getParty(req.params.id);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      const host = await storage.getUser(party.hostId);
      const attendeeCount = await storage.getAttendeeCount(party.id);
      return res.json({
        ...party,
        hostName: host?.fullName || "Unknown",
        hostAvatar: host?.avatar || "",
        hostVerified: host?.isIdVerified || false,
        attendeeCount,
      });
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.post("/api/parties", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const parsed = insertPartySchema.safeParse({ ...req.body, hostId: req.session.userId });
      if (!parsed.success) {
        return res.status(400).json({ message: "Invalid input", errors: parsed.error.errors });
      }
      const party = await storage.createParty(parsed.data);
      return res.status(201).json(party);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.patch("/api/parties/:id", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const party = await storage.getParty(req.params.id);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      if (party.hostId !== req.session.userId) {
        return res.status(403).json({ message: "Not authorized" });
      }
      const updated = await storage.updateParty(req.params.id, req.body);
      return res.json(updated);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.delete("/api/parties/:id", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const party = await storage.getParty(req.params.id);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      if (party.hostId !== req.session.userId) {
        return res.status(403).json({ message: "Not authorized" });
      }
      await storage.deleteParty(req.params.id);
      return res.json({ message: "Party deleted" });
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/parties/:id/attendees", async (req, res) => {
    try {
      const attendees = await storage.getPartyAttendees(req.params.id);
      const attendeesWithInfo = await Promise.all(
        attendees.map(async (a) => {
          const user = await storage.getUser(a.userId);
          return {
            ...a,
            username: user?.username || "",
            fullName: user?.fullName || "",
            avatar: user?.avatar || "",
            isIdVerified: user?.isIdVerified || false,
          };
        })
      );
      return res.json(attendeesWithInfo);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  // Party Request Routes
  app.get("/api/requests/mine", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const requests = await storage.getUserRequests(req.session.userId);
      return res.json(requests);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.get("/api/parties/:id/requests", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const party = await storage.getParty(req.params.id);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      if (party.hostId !== req.session.userId) {
        return res.status(403).json({ message: "Not authorized" });
      }
      const requests = await storage.getPartyRequests(req.params.id);
      const requestsWithInfo = await Promise.all(
        requests.map(async (r) => {
          const user = await storage.getUser(r.userId);
          return {
            ...r,
            username: user?.username || "",
            fullName: user?.fullName || "",
            avatar: user?.avatar || "",
            isIdVerified: user?.isIdVerified || false,
          };
        })
      );
      return res.json(requestsWithInfo);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.post("/api/parties/:id/requests", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const party = await storage.getParty(req.params.id);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      const request = await storage.createPartyRequest({
        partyId: req.params.id,
        userId: req.session.userId,
        message: req.body.message || "",
        pledgedItems: req.body.pledgedItems || "",
        status: "pending",
      });
      return res.status(201).json(request);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  app.patch("/api/requests/:id/status", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const { status } = req.body;
      if (!status || !["accepted", "declined"].includes(status)) {
        return res.status(400).json({ message: "Status must be 'accepted' or 'declined'" });
      }
      const requests = await storage.getUserRequests(req.session.userId);
      const allRequests = await storage.getPartyRequests("");
      
      const updatedRequest = await storage.updateRequestStatus(req.params.id, status);
      if (!updatedRequest) {
        return res.status(404).json({ message: "Request not found" });
      }
      const party = await storage.getParty(updatedRequest.partyId);
      if (!party) {
        return res.status(404).json({ message: "Party not found" });
      }
      if (party.hostId !== req.session.userId) {
        return res.status(403).json({ message: "Not authorized" });
      }
      if (status === "accepted") {
        await storage.addAttendee(updatedRequest.partyId, updatedRequest.userId);
      }
      return res.json(updatedRequest);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  // Review Routes
  app.post("/api/reviews", async (req, res) => {
    try {
      if (!req.session.userId) {
        return res.status(401).json({ message: "Not authenticated" });
      }
      const review = await storage.createReview({
        ...req.body,
        authorId: req.session.userId,
      });
      return res.status(201).json(review);
    } catch (error) {
      return res.status(500).json({ message: "Internal server error" });
    }
  });

  seedDatabase().catch(console.error);

  return httpServer;
}

async function seedDatabase() {
  const existingUsers = await storage.getUserByUsername("sarah_j");
  if (existingUsers) {
    console.log("Database already seeded, skipping...");
    return;
  }

  console.log("Seeding database...");

  const sarah = await storage.createUser({
    username: "sarah_j",
    password: "password123",
    fullName: "Sarah Jenkins",
    nickname: "SJ",
    avatar: "",
    bio: "Music producer and party enthusiast. Love bringing people together through beats and good vibes.",
    isIdVerified: true,
    dob: "1995-03-15",
    email: "sarah@example.com",
    phone: "+1555-0101",
    country: "US",
    city: "Brooklyn",
    address: "123 Bedford Ave",
    hostRating: 4.9,
    guestRating: 4.7,
    notificationsEnabled: true,
    darkMode: false,
    searchRadius: 50,
  });

  const james = await storage.createUser({
    username: "james_k",
    password: "password123",
    fullName: "James Kovach",
    nickname: "JK",
    avatar: "",
    bio: "Loves dancing, vinyl records, and craft cocktails. Always looking for the next great house party.",
    isIdVerified: true,
    dob: "1992-07-22",
    email: "james@example.com",
    phone: "+1555-0102",
    country: "US",
    city: "Queens",
    address: "456 Queens Blvd",
    hostRating: 4.0,
    guestRating: 5.0,
    notificationsEnabled: true,
    darkMode: true,
    searchRadius: 30,
  });

  const lisa = await storage.createUser({
    username: "lisa_vibe",
    password: "password123",
    fullName: "Lisa Vanderpump",
    nickname: "LV",
    avatar: "",
    bio: "Vibe specialist and cocktail connoisseur. I curate experiences, not just parties.",
    isIdVerified: true,
    dob: "1990-11-08",
    email: "lisa@example.com",
    phone: "+1555-0103",
    country: "US",
    city: "Manhattan",
    address: "789 5th Ave",
    hostRating: 4.5,
    guestRating: 4.5,
    notificationsEnabled: true,
    darkMode: false,
    searchRadius: 25,
  });

  const marcus = await storage.createUser({
    username: "marcus_pizza",
    password: "password123",
    fullName: "Marcus Chen",
    nickname: "MC",
    avatar: "",
    bio: "Pizza enthusiast and pool party king. If the pizza is good and the pool is warm, count me in.",
    isIdVerified: true,
    dob: "1993-05-30",
    email: "marcus@example.com",
    phone: "+1555-0104",
    country: "US",
    city: "Chicago",
    address: "321 Michigan Ave",
    hostRating: 4.6,
    guestRating: 4.8,
    notificationsEnabled: true,
    darkMode: false,
    searchRadius: 40,
  });

  const nova = await storage.createUser({
    username: "dj_nova",
    password: "password123",
    fullName: "Nova Williams",
    nickname: "DJ Nova",
    avatar: "",
    bio: "DJ and event organizer. Turning up the volume and the good times since 2015.",
    isIdVerified: true,
    dob: "1994-09-12",
    email: "nova@example.com",
    phone: "+1555-0105",
    country: "US",
    city: "Miami",
    address: "555 Ocean Dr",
    hostRating: 4.9,
    guestRating: 4.3,
    notificationsEnabled: true,
    darkMode: true,
    searchRadius: 60,
  });

  const party1 = await storage.createParty({
    hostId: sarah.id,
    title: "Neon Underground Techno Night",
    theme: "Cyberpunk/Neon",
    description: "Dive into a neon-lit underground techno experience. Expect pulsating beats, UV lights, and an electric atmosphere. Dress code: Cyberpunk or anything that glows.",
    date: "2026-03-15T22:00:00",
    locationName: "The Underground Warehouse",
    city: "Brooklyn",
    country: "US",
    exactAddress: "88 Warehouse St, Brooklyn, NY 11222",
    latitude: 40.7282,
    longitude: -73.9542,
    maxGuests: 40,
    price: 15,
    whatToBring: ["Glowsticks", "Good vibes", "Dancing shoes"],
    imageUrl: "/images/party-neon-techno.png",
    galleryUrls: ["/images/party-neon-techno.png"],
    includesAlcohol: true,
  });

  const party2 = await storage.createParty({
    hostId: lisa.id,
    title: "Sunset Rooftop Cocktails",
    theme: "Cocktail/Lounge",
    description: "Watch the sun set over Manhattan while sipping handcrafted cocktails. Live jazz, city skyline views, and an unforgettable evening awaits.",
    date: "2026-04-05T18:00:00",
    locationName: "Skyline Terrace",
    city: "Manhattan",
    country: "US",
    exactAddress: "200 W 42nd St, New York, NY 10036",
    latitude: 40.7580,
    longitude: -73.9855,
    maxGuests: 30,
    price: 25,
    whatToBring: ["Your favorite cocktail recipe", "A light jacket"],
    imageUrl: "/images/party-rooftop-cocktail.png",
    galleryUrls: ["/images/party-rooftop-cocktail.png"],
    includesAlcohol: true,
  });

  const party3 = await storage.createParty({
    hostId: marcus.id,
    title: "Summer Pool Splash",
    theme: "Pool Party",
    description: "Make a splash at the ultimate summer pool party! Water slides, floaties, pizza bar, and tropical drinks. Bring your swimsuit and sunscreen.",
    date: "2026-06-20T14:00:00",
    locationName: "Lakeshore Pool Club",
    city: "Chicago",
    country: "US",
    exactAddress: "900 N Lake Shore Dr, Chicago, IL 60611",
    latitude: 41.8991,
    longitude: -87.6151,
    maxGuests: 50,
    price: 10,
    whatToBring: ["Swimsuit", "Sunscreen", "Towel", "Snacks to share"],
    imageUrl: "/images/party-pool.png",
    galleryUrls: ["/images/party-pool.png"],
    includesAlcohol: true,
  });

  const party4 = await storage.createParty({
    hostId: james.id,
    title: "Cozy Vinyl & Wine Night",
    theme: "Indie/Bohemian",
    description: "An intimate evening of vinyl records, natural wine, and great conversation. Bring your favorite record to share with the group. Low-key, high-quality vibes only.",
    date: "2026-03-28T19:00:00",
    locationName: "James's Loft",
    city: "Queens",
    country: "US",
    exactAddress: "42 Astoria Blvd, Queens, NY 11103",
    latitude: 40.7720,
    longitude: -73.9073,
    maxGuests: 15,
    price: 0,
    whatToBring: ["A vinyl record", "A bottle of wine", "Open mind"],
    imageUrl: "/images/party-house.png",
    galleryUrls: ["/images/party-house.png"],
    includesAlcohol: true,
  });

  const party5 = await storage.createParty({
    hostId: nova.id,
    title: "Electric Festival Pre-Party",
    theme: "Festival/EDM",
    description: "Get hyped for festival season at this high-energy pre-party. Full DJ setup, laser lights, fog machines, and non-stop EDM. This is where the weekend begins.",
    date: "2026-05-10T21:00:00",
    locationName: "Nova's Beach House",
    city: "Miami",
    country: "US",
    exactAddress: "1200 Collins Ave, Miami Beach, FL 33139",
    latitude: 25.7825,
    longitude: -80.1304,
    maxGuests: 100,
    price: 20,
    whatToBring: ["Festival gear", "Energy drinks", "Comfortable shoes"],
    imageUrl: "/images/party-festival.png",
    galleryUrls: ["/images/party-festival.png"],
    includesAlcohol: true,
  });

  await storage.addAttendee(party1.id, james.id);
  await storage.addAttendee(party1.id, lisa.id);
  await storage.addAttendee(party1.id, nova.id);
  await storage.addAttendee(party2.id, sarah.id);
  await storage.addAttendee(party2.id, marcus.id);
  await storage.addAttendee(party3.id, james.id);
  await storage.addAttendee(party3.id, nova.id);
  await storage.addAttendee(party4.id, sarah.id);
  await storage.addAttendee(party4.id, lisa.id);
  await storage.addAttendee(party5.id, sarah.id);
  await storage.addAttendee(party5.id, marcus.id);
  await storage.addAttendee(party5.id, james.id);

  await storage.createReview({
    authorId: james.id,
    targetId: sarah.id,
    partyId: party1.id,
    content: "Sarah throws the best techno parties! The vibe was incredible and the music selection was top-notch. Will definitely be back.",
    rating: 5,
    type: "host",
  });

  await storage.createReview({
    authorId: sarah.id,
    targetId: james.id,
    partyId: party1.id,
    content: "James was an amazing guest. Brought great energy to the dance floor and was respectful of the space. Welcome anytime!",
    rating: 5,
    type: "guest",
  });

  await storage.createReview({
    authorId: marcus.id,
    targetId: lisa.id,
    partyId: party2.id,
    content: "Lisa's rooftop cocktail party was pure class. The drinks were phenomenal and the sunset views were breathtaking.",
    rating: 4,
    type: "host",
  });

  await storage.createPartyRequest({
    partyId: party5.id,
    userId: lisa.id,
    message: "Would love to join! I can help with the cocktail setup.",
    pledgedItems: "Cocktail shaker and premium mixers",
    status: "pending",
  });

  console.log("Database seeded successfully!");
}


================================================================
FILE: client/src/App.tsx
================================================================
import { Switch, Route, useLocation, Redirect } from "wouter";
import { queryClient } from "./lib/queryClient";
import { QueryClientProvider } from "@tanstack/react-query";
import { Toaster } from "@/components/ui/toaster";
import { TooltipProvider } from "@/components/ui/tooltip";
import { ThemeProvider } from "@/components/theme-provider";
import { useAuth } from "@/hooks/use-auth";
import NotFound from "@/pages/not-found";
import AuthPage from "@/pages/auth-page";
import OnboardingPage from "@/pages/onboarding-page";
import BrowsePage from "@/pages/browse-page";
import PartyDetailPage from "@/pages/party-detail-page";
import ProfilePage from "@/pages/profile-page";
import SettingsPage from "@/pages/settings-page";
import CreatePartyPage from "@/pages/create-party-page";
import HostPage from "@/pages/host-page";
import AttendingPage from "@/pages/attending-page";
import { MobileNav } from "@/components/mobile-nav";
import { Skeleton } from "@/components/ui/skeleton";

function AuthGuard({ children }: { children: React.ReactNode }) {
  const { user, isLoading, isAuthenticated } = useAuth();
  const [location] = useLocation();

  if (isLoading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="flex flex-col items-center gap-4">
          <Skeleton className="h-12 w-12 rounded-full" />
          <Skeleton className="h-4 w-32" />
        </div>
      </div>
    );
  }

  if (!isAuthenticated) {
    return <Redirect to="/auth" />;
  }

  if (user && (!user.city || !user.country) && location !== "/onboarding") {
    return <Redirect to="/onboarding" />;
  }

  return <>{children}</>;
}

function Router() {
  return (
    <Switch>
      <Route path="/auth" component={AuthPage} />
      <Route path="/">
        <AuthGuard>
          <BrowsePage />
        </AuthGuard>
      </Route>
      <Route path="/browse">
        <AuthGuard>
          <BrowsePage />
        </AuthGuard>
      </Route>
      <Route path="/onboarding">
        <AuthGuard>
          <OnboardingPage />
        </AuthGuard>
      </Route>
      <Route path="/party/:id">
        <AuthGuard>
          <PartyDetailPage />
        </AuthGuard>
      </Route>
      <Route path="/profile">
        <AuthGuard>
          <ProfilePage />
        </AuthGuard>
      </Route>
      <Route path="/settings">
        <AuthGuard>
          <SettingsPage />
        </AuthGuard>
      </Route>
      <Route path="/create-party">
        <AuthGuard>
          <CreatePartyPage />
        </AuthGuard>
      </Route>
      <Route path="/host">
        <AuthGuard>
          <HostPage />
        </AuthGuard>
      </Route>
      <Route path="/attending">
        <AuthGuard>
          <AttendingPage />
        </AuthGuard>
      </Route>
      <Route component={NotFound} />
    </Switch>
  );
}

function AppContent() {
  const { isAuthenticated } = useAuth();
  const [location] = useLocation();
  const hideNav = ["/auth", "/onboarding"].includes(location);

  return (
    <div className="min-h-screen bg-background">
      <Router />
      {isAuthenticated && !hideNav && <MobileNav />}
    </div>
  );
}

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <ThemeProvider>
        <TooltipProvider>
          <AppContent />
          <Toaster />
        </TooltipProvider>
      </ThemeProvider>
    </QueryClientProvider>
  );
}

export default App;


================================================================
FILE: client/src/index.css
================================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

/* LIGHT MODE */
:root {
  --button-outline: rgba(0,0,0, .10);
  --badge-outline: rgba(0,0,0, .05);
  --opaque-button-border-intensity: -8;
  --elevate-1: rgba(0,0,0, .03);
  --elevate-2: rgba(0,0,0, .08);
  --background: 0 0% 100%;
  --foreground: 0 0% 9%;
  --border: 0 0% 91%;
  --card: 0 0% 98%;
  --card-foreground: 0 0% 9%;
  --card-border: 0 0% 95%;
  --sidebar: 0 0% 96%;
  --sidebar-foreground: 0 0% 9%;
  --sidebar-border: 0 0% 93%;
  --sidebar-primary: 280 85% 45%;
  --sidebar-primary-foreground: 280 20% 98%;
  --sidebar-accent: 280 12% 92%;
  --sidebar-accent-foreground: 280 8% 15%;
  --sidebar-ring: 280 85% 45%;
  --popover: 0 0% 94%;
  --popover-foreground: 0 0% 9%;
  --popover-border: 0 0% 91%;
  --primary: 280 85% 45%;
  --primary-foreground: 280 20% 98%;
  --secondary: 280 6% 90%;
  --secondary-foreground: 280 6% 15%;
  --muted: 280 4% 92%;
  --muted-foreground: 280 4% 35%;
  --accent: 280 8% 94%;
  --accent-foreground: 280 8% 15%;
  --destructive: 0 84% 42%;
  --destructive-foreground: 0 20% 98%;
  --input: 0 0% 75%;
  --ring: 280 85% 45%;
  --chart-1: 280 70% 35%;
  --chart-2: 320 65% 38%;
  --chart-3: 200 70% 35%;
  --chart-4: 40 75% 40%;
  --chart-5: 160 65% 35%;
  --font-sans: Open Sans, sans-serif;
  --font-serif: Georgia, serif;
  --font-mono: Menlo, monospace;
  --radius: .5rem;
  --shadow-2xs: 0px 2px 0px 0px hsl(280 85% 45% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(280 85% 45% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(280 85% 45% / 0.00), 0px 1px 2px -1px hsl(280 85% 45% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(280 85% 45% / 0.00), 0px 1px 2px -1px hsl(280 85% 45% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(280 85% 45% / 0.00), 0px 2px 4px -1px hsl(280 85% 45% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(280 85% 45% / 0.00), 0px 4px 6px -1px hsl(280 85% 45% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(280 85% 45% / 0.00), 0px 8px 10px -1px hsl(280 85% 45% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(280 85% 45% / 0.00);
  --tracking-normal: 0em;
  --spacing: 0.25rem;

/* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

.dark {
  --button-outline: rgba(255,255,255, .10);
  --badge-outline: rgba(255,255,255, .05);
  --opaque-button-border-intensity: 9;
  --elevate-1: rgba(255,255,255, .04);
  --elevate-2: rgba(255,255,255, .09);
  --background: 0 0% 7%;
  --foreground: 0 0% 95%;
  --border: 0 0% 16%;
  --card: 0 0% 9%;
  --card-foreground: 0 0% 95%;
  --card-border: 0 0% 12%;
  --sidebar: 0 0% 11%;
  --sidebar-foreground: 0 0% 95%;
  --sidebar-border: 0 0% 14%;
  --sidebar-primary: 280 85% 55%;
  --sidebar-primary-foreground: 280 20% 98%;
  --sidebar-accent: 280 12% 14%;
  --sidebar-accent-foreground: 280 8% 90%;
  --sidebar-ring: 280 85% 55%;
  --popover: 0 0% 13%;
  --popover-foreground: 0 0% 95%;
  --popover-border: 0 0% 16%;
  --primary: 280 85% 55%;
  --primary-foreground: 280 20% 98%;
  --secondary: 280 6% 16%;
  --secondary-foreground: 280 6% 90%;
  --muted: 280 4% 15%;
  --muted-foreground: 280 4% 70%;
  --accent: 280 8% 13%;
  --accent-foreground: 280 8% 90%;
  --destructive: 0 84% 42%;
  --destructive-foreground: 0 20% 98%;
  --input: 0 0% 30%;
  --ring: 280 85% 55%;
  --chart-1: 280 70% 65%;
  --chart-2: 320 65% 68%;
  --chart-3: 200 70% 65%;
  --chart-4: 40 75% 70%;
  --chart-5: 160 65% 65%;
  --shadow-2xs: 0px 2px 0px 0px hsl(280 85% 55% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(280 85% 55% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(280 85% 55% / 0.00), 0px 1px 2px -1px hsl(280 85% 55% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(280 85% 55% / 0.00), 0px 1px 2px -1px hsl(280 85% 55% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(280 85% 55% / 0.00), 0px 2px 4px -1px hsl(280 85% 55% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(280 85% 55% / 0.00), 0px 4px 6px -1px hsl(280 85% 55% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(280 85% 55% / 0.00), 0px 8px 10px -1px hsl(280 85% 55% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(280 85% 55% / 0.00);

/* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
  }
}

/**
 * Using the elevate system.
 * Automatic contrast adjustment.
 *
 * <element className="hover-elevate" />
 * <element className="active-elevate-2" />
 *
 * // Using the tailwind utility when a data attribute is "on"
 * <element className="toggle-elevate data-[state=on]:toggle-elevated" />
 * // Or manually controlling the toggle state
 * <element className="toggle-elevate toggle-elevated" />
 *
 * Elevation systems have to handle many states.
 * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)
 * - toggled or not
 * - focused or not (this is not handled with these utilities)
 *
 * Even without handling focused or not, this is six possible combinations that
 * need to be distinguished from eachother visually.
 */
@layer utilities {

  /* Hide ugly search cancel button in Chrome until we can style it properly */
  input[type="search"]::-webkit-search-cancel-button {
    @apply hidden;
  }

  /* Placeholder styling for contentEditable div */
  [contenteditable][data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: hsl(var(--muted-foreground));
    pointer-events: none;
  }

  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of
   * buttons/badges can remove the automatic brightness adjustment on interactions
   * and program their own. */
  .no-default-hover-elevate {}

  .no-default-active-elevate {}


  /**
   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.
   * This way they can stack/compound. Both will overlap the parent's borders!
   * So borders will be automatically adjusted both on toggle, and hover/active,
   * and they will be compounded.
   */
  .toggle-elevate::before,
  .toggle-elevate-2::before {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: -1;
    /* sits behind content but above backdrop */
  }

  .toggle-elevate.toggle-elevated::before {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  .border.toggle-elevate::before {
    inset: -1px;
  }

  /* Does not work on elements with overflow:hidden! */
  .hover-elevate:not(.no-default-hover-elevate),
  .active-elevate:not(.no-default-active-elevate),
  .hover-elevate-2:not(.no-default-hover-elevate),
  .active-elevate-2:not(.no-default-active-elevate) {
    position: relative;
    z-index: 0;
  }

  .hover-elevate:not(.no-default-hover-elevate)::after,
  .active-elevate:not(.no-default-active-elevate)::after,
  .hover-elevate-2:not(.no-default-hover-elevate)::after,
  .active-elevate-2:not(.no-default-active-elevate)::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: 999;
    /* sits in front of content */
  }

  .hover-elevate:hover:not(.no-default-hover-elevate)::after,
  .active-elevate:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-1);
  }

  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,
  .active-elevate-2:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {
    inset: -1px;
  }

  .glass {
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .dark .glass {
    background: rgba(0, 0, 0, 0.5);
  }
  
  .light .glass,
  :root:not(.dark) .glass {
    background: rgba(255, 255, 255, 0.7);
  }
}


================================================================
FILE: client/src/lib/queryClient.ts
================================================================
import { QueryClient, QueryFunction } from "@tanstack/react-query";

async function throwIfResNotOk(res: Response) {
  if (!res.ok) {
    const text = (await res.text()) || res.statusText;
    throw new Error(`${res.status}: ${text}`);
  }
}

export async function apiRequest(
  method: string,
  url: string,
  data?: unknown | undefined,
): Promise<Response> {
  const res = await fetch(url, {
    method,
    headers: data ? { "Content-Type": "application/json" } : {},
    body: data ? JSON.stringify(data) : undefined,
    credentials: "include",
  });

  await throwIfResNotOk(res);
  return res;
}

type UnauthorizedBehavior = "returnNull" | "throw";
export const getQueryFn: <T>(options: {
  on401: UnauthorizedBehavior;
}) => QueryFunction<T> =
  ({ on401: unauthorizedBehavior }) =>
  async ({ queryKey }) => {
    const res = await fetch(queryKey.join("/") as string, {
      credentials: "include",
    });

    if (unauthorizedBehavior === "returnNull" && res.status === 401) {
      return null;
    }

    await throwIfResNotOk(res);
    return await res.json();
  };

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryFn: getQueryFn({ on401: "throw" }),
      refetchInterval: false,
      refetchOnWindowFocus: false,
      staleTime: Infinity,
      retry: false,
    },
    mutations: {
      retry: false,
    },
  },
});


================================================================
FILE: client/src/hooks/use-auth.ts
================================================================
import { useQuery, useMutation } from "@tanstack/react-query";
import { apiRequest, queryClient, getQueryFn } from "@/lib/queryClient";
import { useLocation } from "wouter";
import type { User } from "@shared/schema";

export function useAuth() {
  const [, setLocation] = useLocation();

  const { data: user, isLoading } = useQuery<User | null>({
    queryKey: ["/api/auth/me"],
    queryFn: getQueryFn({ on401: "returnNull" }),
    retry: false,
    staleTime: 5 * 60 * 1000,
  });

  const logoutMutation = useMutation({
    mutationFn: async () => {
      await apiRequest("POST", "/api/auth/logout");
    },
    onSuccess: () => {
      queryClient.setQueryData(["/api/auth/me"], null);
      setLocation("/auth");
    },
  });

  return {
    user: user ?? null,
    isLoading,
    isAuthenticated: !!user,
    logout: logoutMutation.mutate,
  };
}


================================================================
FILE: client/src/hooks/use-toast.ts
================================================================
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


================================================================
FILE: client/src/components/theme-provider.tsx
================================================================
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "light" | "dark";

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
  setTheme: (theme: Theme) => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setThemeState] = useState<Theme>(() => {
    if (typeof window !== "undefined") {
      return (localStorage.getItem("cambuapp-theme") as Theme) || "dark";
    }
    return "dark";
  });

  useEffect(() => {
    const root = document.documentElement;
    if (theme === "dark") {
      root.classList.add("dark");
    } else {
      root.classList.remove("dark");
    }
    localStorage.setItem("cambuapp-theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setThemeState((prev) => (prev === "dark" ? "light" : "dark"));
  };

  const setTheme = (t: Theme) => setThemeState(t);

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) throw new Error("useTheme must be used within ThemeProvider");
  return context;
}


================================================================
FILE: client/src/components/mobile-nav.tsx
================================================================
import { useLocation } from "wouter";
import { Search, Home, Calendar, User, Plus } from "lucide-react";

const navItems = [
  { path: "/browse", label: "Browse", icon: Search },
  { path: "/host", label: "Host", icon: Home },
  { path: "/create-party", label: "Create", icon: Plus },
  { path: "/attending", label: "Going", icon: Calendar },
  { path: "/profile", label: "Profile", icon: User },
];

export function MobileNav() {
  const [location, setLocation] = useLocation();

  const isActive = (path: string) => {
    if (path === "/browse") return location === "/" || location === "/browse";
    return location === path;
  };

  return (
    <nav className="fixed bottom-4 inset-x-4 glass border border-border/30 p-1.5 flex justify-around z-50 rounded-[28px]" data-testid="mobile-nav">
      {navItems.map((item) => {
        const active = isActive(item.path);
        const Icon = item.icon;
        const isCreate = item.path === "/create-party";

        return (
          <button
            key={item.path}
            onClick={() => setLocation(item.path)}
            data-testid={`nav-${item.label.toLowerCase()}`}
            className={`relative flex flex-col items-center gap-0.5 px-3 py-2 rounded-[22px] transition-all duration-200 ${
              isCreate
                ? "bg-primary text-primary-foreground px-4"
                : active
                  ? "bg-foreground/10 dark:bg-foreground/15 text-foreground"
                  : "text-muted-foreground"
            }`}
          >
            <Icon size={20} strokeWidth={active || isCreate ? 2.5 : 2} />
            <span className="text-[10px] font-medium leading-none">{item.label}</span>
          </button>
        );
      })}
    </nav>
  );
}


================================================================
FILE: client/src/pages/auth-page.tsx
================================================================
import { useState, useEffect } from "react";
import { useLocation } from "wouter";
import { useMutation } from "@tanstack/react-query";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { useAuth } from "@/hooks/use-auth";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { PartyPopper, Sparkles, Loader2 } from "lucide-react";

const loginSchema = z.object({
  username: z.string().min(1, "Username is required"),
  password: z.string().min(1, "Password is required"),
});

const registerSchema = z.object({
  username: z.string().min(3, "Username must be at least 3 characters"),
  email: z.string().email("Please enter a valid email"),
  password: z.string().min(6, "Password must be at least 6 characters"),
  fullName: z.string().min(2, "Full name is required"),
});

type LoginValues = z.infer<typeof loginSchema>;
type RegisterValues = z.infer<typeof registerSchema>;

export default function AuthPage() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const { user, isLoading: authLoading } = useAuth();
  const [activeTab, setActiveTab] = useState("signin");

  const loginForm = useForm<LoginValues>({
    resolver: zodResolver(loginSchema),
    defaultValues: { username: "", password: "" },
  });

  const registerForm = useForm<RegisterValues>({
    resolver: zodResolver(registerSchema),
    defaultValues: { username: "", email: "", password: "", fullName: "" },
  });

  const loginMutation = useMutation({
    mutationFn: async (values: LoginValues) => {
      const res = await apiRequest("POST", "/api/auth/login", values);
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/auth/me"] });
      toast({ title: "Welcome back!", description: "You've signed in successfully." });
      setLocation("/");
    },
    onError: (error: Error) => {
      toast({
        title: "Sign in failed",
        description: error.message.includes("401") ? "Invalid username or password" : error.message,
        variant: "destructive",
      });
    },
  });

  const registerMutation = useMutation({
    mutationFn: async (values: RegisterValues) => {
      const res = await apiRequest("POST", "/api/auth/register", values);
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/auth/me"] });
      toast({ title: "Account created!", description: "Let's set up your profile." });
      setLocation("/onboarding");
    },
    onError: (error: Error) => {
      toast({
        title: "Registration failed",
        description: error.message.includes("409") ? "Username already taken" : error.message,
        variant: "destructive",
      });
    },
  });

  useEffect(() => {
    if (user && !authLoading) {
      setLocation("/");
    }
  }, [user, authLoading, setLocation]);

  if (authLoading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <Loader2 className="w-8 h-8 animate-spin text-muted-foreground" />
      </div>
    );
  }

  if (user) return null;

  return (
    <div className="min-h-screen bg-background flex flex-col">
      <div className="relative overflow-hidden py-16 px-4 flex flex-col items-center justify-center"
        style={{
          background: "linear-gradient(135deg, hsl(280 85% 15%) 0%, hsl(280 85% 8%) 50%, hsl(300 60% 10%) 100%)",
        }}
      >
        <div
          className="absolute inset-0 opacity-20"
          style={{
            background: "radial-gradient(circle at 30% 50%, hsl(280 85% 55% / 0.4) 0%, transparent 50%), radial-gradient(circle at 70% 30%, hsl(320 65% 50% / 0.3) 0%, transparent 40%)",
          }}
        />
        <div className="relative z-10 text-center">
          <div className="flex items-center justify-center gap-3 mb-3">
            <PartyPopper className="w-10 h-10 text-primary-foreground" />
            <h1 className="text-4xl font-bold text-primary-foreground tracking-tight" data-testid="text-app-title">
              CambuApp
            </h1>
            <Sparkles className="w-8 h-8 text-primary-foreground opacity-80" />
          </div>
          <p className="text-primary-foreground/70 text-lg" data-testid="text-app-tagline">
            The Party Vibe Network
          </p>
        </div>
      </div>

      <div className="flex-1 flex items-start justify-center px-4 -mt-8 pb-12">
        <Card className="w-full max-w-md relative z-10">
          <CardContent className="pt-6">
            <Tabs value={activeTab} onValueChange={setActiveTab}>
              <TabsList className="w-full mb-6">
                <TabsTrigger value="signin" className="flex-1" data-testid="tab-signin">
                  Sign In
                </TabsTrigger>
                <TabsTrigger value="signup" className="flex-1" data-testid="tab-signup">
                  Sign Up
                </TabsTrigger>
              </TabsList>

              <TabsContent value="signin">
                <Form {...loginForm}>
                  <form
                    onSubmit={loginForm.handleSubmit((v) => loginMutation.mutate(v))}
                    className="space-y-4"
                    data-testid="form-signin"
                  >
                    <FormField
                      control={loginForm.control}
                      name="username"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Username</FormLabel>
                          <FormControl>
                            <Input
                              placeholder="Enter your username"
                              data-testid="input-login-username"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={loginForm.control}
                      name="password"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Password</FormLabel>
                          <FormControl>
                            <Input
                              type="password"
                              placeholder="Enter your password"
                              data-testid="input-login-password"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <Button
                      type="submit"
                      className="w-full"
                      disabled={loginMutation.isPending}
                      data-testid="button-signin"
                    >
                      {loginMutation.isPending ? (
                        <Loader2 className="w-4 h-4 animate-spin mr-2" />
                      ) : null}
                      Sign In
                    </Button>
                  </form>
                </Form>
                <p className="text-center text-sm text-muted-foreground mt-4">
                  Don't have an account?{" "}
                  <button
                    type="button"
                    className="text-foreground underline underline-offset-2"
                    onClick={() => setActiveTab("signup")}
                    data-testid="link-goto-signup"
                  >
                    Sign up
                  </button>
                </p>
              </TabsContent>

              <TabsContent value="signup">
                <Form {...registerForm}>
                  <form
                    onSubmit={registerForm.handleSubmit((v) => registerMutation.mutate(v))}
                    className="space-y-4"
                    data-testid="form-signup"
                  >
                    <FormField
                      control={registerForm.control}
                      name="fullName"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Full Name</FormLabel>
                          <FormControl>
                            <Input
                              placeholder="Your full name"
                              data-testid="input-register-fullname"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={registerForm.control}
                      name="username"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Username</FormLabel>
                          <FormControl>
                            <Input
                              placeholder="Choose a username"
                              data-testid="input-register-username"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={registerForm.control}
                      name="email"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Email</FormLabel>
                          <FormControl>
                            <Input
                              type="email"
                              placeholder="you@example.com"
                              data-testid="input-register-email"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={registerForm.control}
                      name="password"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Password</FormLabel>
                          <FormControl>
                            <Input
                              type="password"
                              placeholder="At least 6 characters"
                              data-testid="input-register-password"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <Button
                      type="submit"
                      className="w-full"
                      disabled={registerMutation.isPending}
                      data-testid="button-signup"
                    >
                      {registerMutation.isPending ? (
                        <Loader2 className="w-4 h-4 animate-spin mr-2" />
                      ) : null}
                      Create Account
                    </Button>
                  </form>
                </Form>
                <p className="text-center text-sm text-muted-foreground mt-4">
                  Already have an account?{" "}
                  <button
                    type="button"
                    className="text-foreground underline underline-offset-2"
                    onClick={() => setActiveTab("signin")}
                    data-testid="link-goto-signin"
                  >
                    Sign in
                  </button>
                </p>
              </TabsContent>
            </Tabs>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


================================================================
FILE: client/src/pages/onboarding-page.tsx
================================================================
import { useState } from "react";
import { useLocation } from "wouter";
import { useMutation } from "@tanstack/react-query";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { useAuth } from "@/hooks/use-auth";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Avatar, AvatarFallback } from "@/components/ui/avatar";
import { PartyPopper, ChevronRight, ChevronLeft, Check, User, Loader2 } from "lucide-react";

const COUNTRIES = [
  { value: "USA", label: "USA" },
  { value: "United Kingdom", label: "United Kingdom" },
  { value: "Germany", label: "Germany" },
  { value: "Romania", label: "Romania" },
] as const;

const CITIES_BY_COUNTRY: Record<string, string[]> = {
  USA: ["New York", "Los Angeles", "Chicago", "Miami", "Austin", "San Francisco", "Seattle", "Denver"],
  "United Kingdom": ["London", "Manchester", "Birmingham", "Edinburgh", "Bristol", "Glasgow", "Liverpool"],
  Germany: ["Berlin", "Munich", "Hamburg", "Cologne", "Frankfurt", "Stuttgart", "Dsseldorf"],
  Romania: ["Bucharest", "Cluj-Napoca", "Timioara", "Iai", "Constana", "Braov", "Sibiu", "Vama Veche"],
};

const personalInfoSchema = z.object({
  nickname: z.string().optional(),
  dob: z.string().optional(),
  phone: z.string().optional(),
  bio: z.string().optional(),
});

const locationSchema = z.object({
  country: z.string().min(1, "Please select a country"),
  city: z.string().min(1, "Please select a city"),
  address: z.string().optional(),
});

type PersonalInfoValues = z.infer<typeof personalInfoSchema>;
type LocationValues = z.infer<typeof locationSchema>;

export default function OnboardingPage() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const { user, isLoading } = useAuth();
  const [currentStep, setCurrentStep] = useState(1);

  const personalForm = useForm<PersonalInfoValues>({
    resolver: zodResolver(personalInfoSchema),
    defaultValues: { nickname: "", dob: "", phone: "", bio: "" },
  });

  const locationForm = useForm<LocationValues>({
    resolver: zodResolver(locationSchema),
    defaultValues: { country: "", city: "", address: "" },
  });

  const selectedCountry = locationForm.watch("country");

  const updateMutation = useMutation({
    mutationFn: async (data: Record<string, unknown>) => {
      if (!user) throw new Error("Not authenticated");
      const res = await apiRequest("PATCH", `/api/users/${user.id}`, data);
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/auth/me"] });
    },
    onError: (error: Error) => {
      toast({
        title: "Update failed",
        description: error.message,
        variant: "destructive",
      });
    },
  });

  if (isLoading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <Loader2 className="w-8 h-8 animate-spin text-muted-foreground" />
      </div>
    );
  }

  if (!user) {
    return null;
  }

  const handleStep1Next = async (values: PersonalInfoValues) => {
    await updateMutation.mutateAsync({
      nickname: values.nickname || undefined,
      dob: values.dob || undefined,
      phone: values.phone || undefined,
      bio: values.bio || undefined,
    });
    setCurrentStep(2);
  };

  const handleStep2Next = async (values: LocationValues) => {
    await updateMutation.mutateAsync({
      country: values.country,
      city: values.city,
      address: values.address || undefined,
    });
    setCurrentStep(3);
  };

  const handleComplete = () => {
    toast({ title: "Welcome to CambuApp!", description: "Your profile is all set. Start exploring parties!" });
    setLocation("/");
  };

  const handleSkip = () => {
    toast({ title: "Welcome to CambuApp!", description: "You can update your profile anytime." });
    setLocation("/");
  };

  const steps = [
    { number: 1, label: "Personal" },
    { number: 2, label: "Location" },
    { number: 3, label: "Photo" },
  ];

  const initials = user.fullName
    ? user.fullName.split(" ").map((n) => n[0]).join("").toUpperCase().slice(0, 2)
    : "U";

  return (
    <div className="min-h-screen bg-background flex flex-col">
      <div
        className="relative overflow-hidden py-10 px-4 flex flex-col items-center"
        style={{
          background: "linear-gradient(135deg, hsl(280 85% 15%) 0%, hsl(280 85% 8%) 50%, hsl(300 60% 10%) 100%)",
        }}
      >
        <div
          className="absolute inset-0 opacity-20"
          style={{
            background: "radial-gradient(circle at 30% 50%, hsl(280 85% 55% / 0.4) 0%, transparent 50%)",
          }}
        />
        <div className="relative z-10 text-center">
          <div className="flex items-center justify-center gap-2 mb-2">
            <PartyPopper className="w-7 h-7 text-primary-foreground" />
            <h1 className="text-2xl font-bold text-primary-foreground" data-testid="text-onboarding-title">
              Set Up Your Profile
            </h1>
          </div>
          <p className="text-primary-foreground/70 text-sm" data-testid="text-onboarding-subtitle">
            Step {currentStep} of 3
          </p>
        </div>
      </div>

      <div className="flex items-center justify-center gap-2 px-4 -mt-4 relative z-10 mb-6">
        {steps.map((step) => (
          <div key={step.number} className="flex items-center gap-2">
            <div
              className={`w-9 h-9 rounded-full flex items-center justify-center text-sm font-medium transition-colors ${
                currentStep > step.number
                  ? "bg-primary text-primary-foreground"
                  : currentStep === step.number
                    ? "bg-primary text-primary-foreground"
                    : "bg-muted text-muted-foreground"
              }`}
              data-testid={`step-indicator-${step.number}`}
            >
              {currentStep > step.number ? <Check className="w-4 h-4" /> : step.number}
            </div>
            {step.number < 3 && (
              <div
                className={`w-12 h-0.5 ${
                  currentStep > step.number ? "bg-primary" : "bg-muted"
                }`}
              />
            )}
          </div>
        ))}
      </div>

      <div className="flex-1 flex items-start justify-center px-4 pb-12">
        <Card className="w-full max-w-md">
          {currentStep === 1 && (
            <>
              <CardHeader>
                <CardTitle data-testid="text-step1-title">Personal Info</CardTitle>
              </CardHeader>
              <CardContent>
                <Form {...personalForm}>
                  <form
                    onSubmit={personalForm.handleSubmit(handleStep1Next)}
                    className="space-y-4"
                    data-testid="form-personal-info"
                  >
                    <FormField
                      control={personalForm.control}
                      name="nickname"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Nickname (optional)</FormLabel>
                          <FormControl>
                            <Input
                              placeholder="What should people call you?"
                              data-testid="input-nickname"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={personalForm.control}
                      name="dob"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Date of Birth</FormLabel>
                          <FormControl>
                            <Input
                              type="date"
                              data-testid="input-dob"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={personalForm.control}
                      name="phone"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Phone Number</FormLabel>
                          <FormControl>
                            <Input
                              type="tel"
                              placeholder="+1 555-0123"
                              data-testid="input-phone"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={personalForm.control}
                      name="bio"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Bio</FormLabel>
                          <FormControl>
                            <Textarea
                              placeholder="Tell people about yourself and what kind of parties you like..."
                              className="resize-none"
                              rows={3}
                              data-testid="input-bio"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <div className="flex items-center gap-3 justify-between pt-2">
                      <Button
                        type="button"
                        variant="ghost"
                        onClick={handleSkip}
                        data-testid="button-skip-onboarding"
                      >
                        Skip for now
                      </Button>
                      <Button
                        type="submit"
                        disabled={updateMutation.isPending}
                        data-testid="button-step1-next"
                      >
                        {updateMutation.isPending ? (
                          <Loader2 className="w-4 h-4 animate-spin mr-2" />
                        ) : null}
                        Next
                        <ChevronRight className="w-4 h-4 ml-1" />
                      </Button>
                    </div>
                  </form>
                </Form>
              </CardContent>
            </>
          )}

          {currentStep === 2 && (
            <>
              <CardHeader>
                <CardTitle data-testid="text-step2-title">Your Location</CardTitle>
              </CardHeader>
              <CardContent>
                <Form {...locationForm}>
                  <form
                    onSubmit={locationForm.handleSubmit(handleStep2Next)}
                    className="space-y-4"
                    data-testid="form-location"
                  >
                    <FormField
                      control={locationForm.control}
                      name="country"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Country</FormLabel>
                          <Select
                            onValueChange={(val) => {
                              field.onChange(val);
                              locationForm.setValue("city", "");
                            }}
                            value={field.value}
                          >
                            <FormControl>
                              <SelectTrigger data-testid="select-country">
                                <SelectValue placeholder="Select your country" />
                              </SelectTrigger>
                            </FormControl>
                            <SelectContent>
                              {COUNTRIES.map((c) => (
                                <SelectItem key={c.value} value={c.value} data-testid={`option-country-${c.value}`}>
                                  {c.label}
                                </SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={locationForm.control}
                      name="city"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>City</FormLabel>
                          <Select
                            onValueChange={field.onChange}
                            value={field.value}
                            disabled={!selectedCountry}
                          >
                            <FormControl>
                              <SelectTrigger data-testid="select-city">
                                <SelectValue placeholder={selectedCountry ? "Select your city" : "Select a country first"} />
                              </SelectTrigger>
                            </FormControl>
                            <SelectContent>
                              {(CITIES_BY_COUNTRY[selectedCountry] || []).map((city) => (
                                <SelectItem key={city} value={city} data-testid={`option-city-${city}`}>
                                  {city}
                                </SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <FormField
                      control={locationForm.control}
                      name="address"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Address (optional)</FormLabel>
                          <FormControl>
                            <Input
                              placeholder="Street address"
                              data-testid="input-address"
                              {...field}
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                    <div className="flex items-center gap-3 justify-between pt-2">
                      <Button
                        type="button"
                        variant="ghost"
                        onClick={() => setCurrentStep(1)}
                        data-testid="button-step2-back"
                      >
                        <ChevronLeft className="w-4 h-4 mr-1" />
                        Back
                      </Button>
                      <Button
                        type="submit"
                        disabled={updateMutation.isPending}
                        data-testid="button-step2-next"
                      >
                        {updateMutation.isPending ? (
                          <Loader2 className="w-4 h-4 animate-spin mr-2" />
                        ) : null}
                        Next
                        <ChevronRight className="w-4 h-4 ml-1" />
                      </Button>
                    </div>
                  </form>
                </Form>
              </CardContent>
            </>
          )}

          {currentStep === 3 && (
            <>
              <CardHeader>
                <CardTitle data-testid="text-step3-title">Profile Photo</CardTitle>
              </CardHeader>
              <CardContent className="flex flex-col items-center space-y-6">
                <Avatar className="w-24 h-24">
                  <AvatarFallback className="bg-primary/20 text-foreground text-2xl">
                    {initials}
                  </AvatarFallback>
                </Avatar>
                <p className="text-sm text-muted-foreground text-center" data-testid="text-photo-hint">
                  You can add a profile photo later from your settings.
                </p>
                <div className="flex items-center gap-3 justify-between w-full pt-2">
                  <Button
                    type="button"
                    variant="ghost"
                    onClick={() => setCurrentStep(2)}
                    data-testid="button-step3-back"
                  >
                    <ChevronLeft className="w-4 h-4 mr-1" />
                    Back
                  </Button>
                  <div className="flex items-center gap-2 flex-wrap">
                    <Button
                      type="button"
                      variant="outline"
                      onClick={handleSkip}
                      data-testid="button-skip-photo"
                    >
                      Skip for now
                    </Button>
                    <Button
                      type="button"
                      onClick={handleComplete}
                      data-testid="button-complete-setup"
                    >
                      <Check className="w-4 h-4 mr-1" />
                      Complete Setup
                    </Button>
                  </div>
                </div>
              </CardContent>
            </>
          )}
        </Card>
      </div>
    </div>
  );
}


================================================================
FILE: client/src/pages/browse-page.tsx
================================================================
import { useState, useMemo } from "react";
import { useQuery } from "@tanstack/react-query";
import { Link } from "wouter";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Slider } from "@/components/ui/slider";
import { Search, SlidersHorizontal, MapPin, Calendar, Users, DollarSign, Wine, Star, ChevronDown, ChevronUp, PartyPopper } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { format } from "date-fns";
import type { Party } from "@shared/schema";

interface EnrichedParty extends Party {
  hostName: string;
  hostAvatar: string;
  hostVerified: boolean;
  attendeeCount: number;
}

const THEMES = [
  "All",
  "Cyberpunk/Neon",
  "Cocktail/Lounge",
  "Pool Party",
  "Indie/Bohemian",
  "Festival/EDM",
];

function formatPartyDate(dateStr: string) {
  try {
    return format(new Date(dateStr), "MMM d, yyyy 'at' h:mm a");
  } catch {
    return dateStr;
  }
}

function PartyCardSkeleton() {
  return (
    <Card className="overflow-visible">
      <Skeleton className="h-48 w-full rounded-t-md rounded-b-none" />
      <CardContent className="p-4 space-y-3">
        <Skeleton className="h-5 w-3/4" />
        <Skeleton className="h-4 w-1/2" />
        <Skeleton className="h-4 w-2/3" />
        <div className="flex items-center gap-2">
          <Skeleton className="h-4 w-16" />
          <Skeleton className="h-4 w-20" />
        </div>
      </CardContent>
    </Card>
  );
}

export default function BrowsePage() {
  const { user } = useAuth();
  const [search, setSearch] = useState("");
  const [filtersOpen, setFiltersOpen] = useState(false);
  const [sortBy, setSortBy] = useState("newest");
  const [maxPrice, setMaxPrice] = useState([200]);
  const [themeFilter, setThemeFilter] = useState("All");

  const { data: parties, isLoading } = useQuery<EnrichedParty[]>({
    queryKey: ["/api/parties"],
  });

  const filteredParties = useMemo(() => {
    if (!parties) return [];
    let result = [...parties];

    if (search.trim()) {
      const q = search.toLowerCase();
      result = result.filter(
        (p) =>
          p.title.toLowerCase().includes(q) ||
          p.theme.toLowerCase().includes(q)
      );
    }

    if (themeFilter !== "All") {
      result = result.filter((p) => p.theme === themeFilter);
    }

    result = result.filter((p) => (p.price ?? 0) <= maxPrice[0]);

    if (sortBy === "price") {
      result.sort((a, b) => (a.price ?? 0) - (b.price ?? 0));
    } else if (sortBy === "newest") {
      result.sort((a, b) => new Date(b.createdAt ?? "").getTime() - new Date(a.createdAt ?? "").getTime());
    }

    return result;
  }, [parties, search, sortBy, maxPrice, themeFilter]);

  return (
    <div className="min-h-screen bg-background pb-28">
      <header className="sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div className="max-w-5xl mx-auto px-4 py-3">
          <div className="flex items-center gap-3 flex-wrap">
            <Link href="/" className="flex items-center gap-2 shrink-0">
              <PartyPopper className="h-6 w-6 text-primary" />
              <span className="text-lg font-bold" data-testid="text-app-name">CambuApp</span>
            </Link>
            <div className="flex-1 min-w-[180px] relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
              <Input
                type="search"
                placeholder="Search parties..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                className="pl-9"
                data-testid="input-search"
              />
            </div>
            <Button
              variant="outline"
              size="icon"
              onClick={() => setFiltersOpen(!filtersOpen)}
              data-testid="button-toggle-filters"
            >
              {filtersOpen ? <ChevronUp className="h-4 w-4" /> : <SlidersHorizontal className="h-4 w-4" />}
            </Button>
          </div>

          {filtersOpen && (
            <div className="mt-3 pb-1 grid grid-cols-1 sm:grid-cols-3 gap-4">
              <div className="space-y-1.5">
                <label className="text-sm text-muted-foreground">Sort by</label>
                <Select value={sortBy} onValueChange={setSortBy}>
                  <SelectTrigger data-testid="select-sort">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="newest">Newest</SelectItem>
                    <SelectItem value="price">Price (low to high)</SelectItem>
                    <SelectItem value="distance">Distance</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              <div className="space-y-1.5">
                <label className="text-sm text-muted-foreground">Max price: ${maxPrice[0]}</label>
                <Slider
                  value={maxPrice}
                  onValueChange={setMaxPrice}
                  max={500}
                  step={5}
                  data-testid="slider-max-price"
                />
              </div>

              <div className="space-y-1.5">
                <label className="text-sm text-muted-foreground">Theme</label>
                <Select value={themeFilter} onValueChange={setThemeFilter}>
                  <SelectTrigger data-testid="select-theme">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {THEMES.map((t) => (
                      <SelectItem key={t} value={t}>
                        {t}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </div>
          )}
        </div>
      </header>

      <main className="max-w-5xl mx-auto px-4 py-6">
        {isLoading ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {Array.from({ length: 6 }).map((_, i) => (
              <PartyCardSkeleton key={i} />
            ))}
          </div>
        ) : filteredParties.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-20 text-center" data-testid="text-empty-state">
            <PartyPopper className="h-12 w-12 text-muted-foreground mb-4" />
            <h2 className="text-xl font-semibold mb-2">No parties found in your area</h2>
            <p className="text-muted-foreground">Try adjusting your filters or search terms</p>
          </div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredParties.map((party) => (
              <Link key={party.id} href={`/party/${party.id}`} data-testid={`link-party-${party.id}`}>
                <Card className="overflow-visible hover-elevate cursor-pointer group">
                  <div className="relative h-48 overflow-hidden rounded-t-md">
                    <img
                      src={party.imageUrl || "/images/party-house.png"}
                      alt={party.title}
                      className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent" />
                    <div className="absolute bottom-3 left-3 right-3 flex items-end justify-between gap-2">
                      <Badge variant="secondary" className="text-xs" data-testid={`badge-theme-${party.id}`}>
                        {party.theme}
                      </Badge>
                      {party.includesAlcohol && (
                        <Wine className="h-4 w-4 text-white/90" />
                      )}
                    </div>
                  </div>
                  <CardContent className="p-4 space-y-2">
                    <h3 className="font-semibold text-base leading-tight line-clamp-1" data-testid={`text-title-${party.id}`}>
                      {party.title}
                    </h3>
                    <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                      <Calendar className="h-3.5 w-3.5 shrink-0" />
                      <span className="truncate">{formatPartyDate(party.date)}</span>
                    </div>
                    <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                      <MapPin className="h-3.5 w-3.5 shrink-0" />
                      <span className="truncate">{party.locationName}, {party.city}</span>
                    </div>
                    <div className="flex items-center justify-between gap-2 pt-1 flex-wrap">
                      <span className="font-bold text-base" data-testid={`text-price-${party.id}`}>
                        {(party.price ?? 0) === 0 ? "FREE" : `$${party.price}`}
                      </span>
                      <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                        <Users className="h-3.5 w-3.5" />
                        <span>{party.attendeeCount ?? 0}/{party.maxGuests} guests</span>
                      </div>
                    </div>
                    <div className="flex items-center gap-2 pt-1 text-sm text-muted-foreground">
                      <Star className="h-3.5 w-3.5 text-primary" />
                      <span className="truncate">Hosted by {party.hostName || "Unknown Host"}</span>
                    </div>
                  </CardContent>
                </Card>
              </Link>
            ))}
          </div>
        )}
      </main>
    </div>
  );
}


================================================================
FILE: client/src/pages/party-detail-page.tsx
================================================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useParams, useLocation } from "wouter";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { useAuth } from "@/hooks/use-auth";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Textarea } from "@/components/ui/textarea";
import { Input } from "@/components/ui/input";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Skeleton } from "@/components/ui/skeleton";
import { ArrowLeft, MapPin, Calendar, Users, DollarSign, Wine, ShieldCheck, Star, Clock, Send, PartyPopper, CheckCircle2 } from "lucide-react";
import { format } from "date-fns";
import type { Party, PartyRequest, User } from "@shared/schema";

interface EnrichedParty extends Party {
  hostName: string;
  hostAvatar: string;
  hostVerified: boolean;
  attendeeCount: number;
  hostRating?: number;
}

interface AttendeeInfo {
  id: string;
  username: string;
  fullName: string;
  avatar: string;
}

function formatPartyDate(dateStr: string) {
  try {
    return format(new Date(dateStr), "EEEE, MMM d, yyyy 'at' h:mm a");
  } catch {
    return dateStr;
  }
}

function DetailSkeleton() {
  return (
    <div className="min-h-screen bg-background">
      <Skeleton className="w-full h-64" />
      <div className="max-w-3xl mx-auto px-4 py-6 space-y-6">
        <Skeleton className="h-8 w-2/3" />
        <Skeleton className="h-5 w-1/2" />
        <Skeleton className="h-20 w-full" />
        <Skeleton className="h-40 w-full" />
      </div>
    </div>
  );
}

export default function PartyDetailPage() {
  const params = useParams<{ id: string }>();
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const { user, isAuthenticated } = useAuth();
  const [message, setMessage] = useState("");
  const [pledgedItems, setPledgedItems] = useState("");

  const { data: party, isLoading: partyLoading } = useQuery<EnrichedParty>({
    queryKey: ["/api/parties", params.id],
  });

  const { data: attendees } = useQuery<AttendeeInfo[]>({
    queryKey: ["/api/parties", params.id, "attendees"],
    enabled: !!params.id,
  });

  const { data: myRequests } = useQuery<PartyRequest[]>({
    queryKey: ["/api/requests/mine"],
    enabled: isAuthenticated,
  });

  const existingRequest = myRequests?.find((r) => r.partyId === params.id);
  const isHost = user?.id === party?.hostId;
  const isAttending = attendees?.some((a) => a.id === user?.id);

  const joinMutation = useMutation({
    mutationFn: async () => {
      await apiRequest("POST", `/api/parties/${params.id}/requests`, {
        message,
        pledgedItems,
      });
    },
    onSuccess: () => {
      toast({ title: "Request sent!", description: "The host will review your request." });
      setMessage("");
      setPledgedItems("");
      queryClient.invalidateQueries({ queryKey: ["/api/requests/mine"] });
    },
    onError: (error: Error) => {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    },
  });

  if (partyLoading) {
    return <DetailSkeleton />;
  }

  if (!party) {
    return (
      <div className="min-h-screen bg-background flex flex-col items-center justify-center">
        <PartyPopper className="h-12 w-12 text-muted-foreground mb-4" />
        <h2 className="text-xl font-semibold mb-2">Party not found</h2>
        <Button variant="outline" onClick={() => setLocation("/browse")} data-testid="button-back-browse">
          Back to Browse
        </Button>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background pb-28">
      <div className="relative h-64 sm:h-80 overflow-hidden">
        <img
          src={party.imageUrl || "/images/party-house.png"}
          alt={party.title}
          className="w-full h-full object-cover"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/20" />
        <div className="absolute top-4 left-4">
          <Button
            variant="outline"
            size="icon"
            onClick={() => setLocation("/browse")}
            className="bg-black/30 backdrop-blur border-white/20 text-white"
            data-testid="button-back"
          >
            <ArrowLeft className="h-4 w-4" />
          </Button>
        </div>
        <div className="absolute bottom-4 left-4 right-4">
          <Badge variant="secondary" className="mb-2" data-testid="badge-party-theme">
            {party.theme}
          </Badge>
          <h1 className="text-2xl sm:text-3xl font-bold text-white mb-1" data-testid="text-party-title">
            {party.title}
          </h1>
          <div className="flex items-center gap-2 text-white/80 text-sm">
            <Calendar className="h-4 w-4" />
            <span>{formatPartyDate(party.date)}</span>
          </div>
        </div>
      </div>

      <div className="max-w-3xl mx-auto px-4 py-6 space-y-6">
        <Card>
          <CardContent className="p-4 space-y-4">
            <div className="flex items-center gap-3">
              <Avatar>
                <AvatarImage src={party.hostAvatar} />
                <AvatarFallback>{party.hostName?.charAt(0)?.toUpperCase() || "H"}</AvatarFallback>
              </Avatar>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-1.5 flex-wrap">
                  <span className="font-semibold" data-testid="text-host-name">{party.hostName}</span>
                  {party.hostVerified && (
                    <ShieldCheck className="h-4 w-4 text-primary shrink-0" />
                  )}
                </div>
                {(party.hostRating ?? 0) > 0 && (
                  <div className="flex items-center gap-1 text-sm text-muted-foreground">
                    <Star className="h-3.5 w-3.5 text-primary" />
                    <span>{party.hostRating?.toFixed(1)}</span>
                  </div>
                )}
              </div>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <div className="flex items-center gap-2 text-sm">
                <MapPin className="h-4 w-4 text-muted-foreground shrink-0" />
                <span className="truncate" data-testid="text-location">{party.locationName}, {party.city}</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <DollarSign className="h-4 w-4 text-muted-foreground shrink-0" />
                <span className="font-semibold" data-testid="text-price">
                  {(party.price ?? 0) === 0 ? "FREE" : `$${party.price}`}
                </span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <Users className="h-4 w-4 text-muted-foreground shrink-0" />
                <span data-testid="text-guests">{party.attendeeCount}/{party.maxGuests} guests</span>
              </div>
              {party.includesAlcohol && (
                <div className="flex items-center gap-2 text-sm">
                  <Wine className="h-4 w-4 text-muted-foreground shrink-0" />
                  <span>Includes alcohol</span>
                </div>
              )}
            </div>
          </CardContent>
        </Card>

        {party.description && (
          <Card>
            <CardContent className="p-4">
              <h2 className="font-semibold mb-2">About this party</h2>
              <p className="text-sm text-muted-foreground whitespace-pre-wrap" data-testid="text-description">
                {party.description}
              </p>
            </CardContent>
          </Card>
        )}

        {party.whatToBring && party.whatToBring.length > 0 && (
          <Card>
            <CardContent className="p-4">
              <h2 className="font-semibold mb-2">What to bring</h2>
              <div className="flex flex-wrap gap-2">
                {party.whatToBring.map((item, i) => (
                  <Badge key={i} variant="secondary" data-testid={`badge-bring-${i}`}>
                    {item}
                  </Badge>
                ))}
              </div>
            </CardContent>
          </Card>
        )}

        {party.galleryUrls && party.galleryUrls.length > 0 && (
          <Card>
            <CardContent className="p-4">
              <h2 className="font-semibold mb-3">Gallery</h2>
              <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
                {party.galleryUrls.map((url, i) => (
                  <div key={i} className="aspect-square overflow-hidden rounded-md">
                    <img
                      src={url}
                      alt={`Gallery ${i + 1}`}
                      className="w-full h-full object-cover"
                      data-testid={`img-gallery-${i}`}
                    />
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        )}

        {attendees && attendees.length > 0 && (
          <Card>
            <CardContent className="p-4">
              <h2 className="font-semibold mb-3">Attendees ({attendees.length})</h2>
              <div className="flex flex-wrap gap-3">
                {attendees.map((attendee) => (
                  <div key={attendee.id} className="flex items-center gap-2" data-testid={`attendee-${attendee.id}`}>
                    <Avatar className="h-8 w-8">
                      <AvatarImage src={attendee.avatar} />
                      <AvatarFallback>{attendee.fullName?.charAt(0)?.toUpperCase() || "?"}</AvatarFallback>
                    </Avatar>
                    <span className="text-sm">{attendee.fullName}</span>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        )}

        {isAuthenticated && !isHost && (
          <Card>
            <CardContent className="p-4">
              {isAttending ? (
                <div className="flex items-center gap-2 text-center justify-center py-4" data-testid="text-attending">
                  <CheckCircle2 className="h-5 w-5 text-green-500" />
                  <span className="font-semibold text-green-500">You're Going!</span>
                </div>
              ) : existingRequest ? (
                <div className="flex items-center gap-2 text-center justify-center py-4" data-testid="text-pending">
                  <Clock className="h-5 w-5 text-muted-foreground" />
                  <span className="text-muted-foreground">
                    Request {existingRequest.status === "pending" ? "pending" : existingRequest.status}
                  </span>
                </div>
              ) : (
                <div className="space-y-3">
                  <h2 className="font-semibold">Request to Join</h2>
                  <Textarea
                    placeholder="Say hi to the host! Why would you be a great guest?"
                    value={message}
                    onChange={(e) => setMessage(e.target.value)}
                    data-testid="input-request-message"
                  />
                  <Input
                    placeholder="What will you bring? (optional)"
                    value={pledgedItems}
                    onChange={(e) => setPledgedItems(e.target.value)}
                    data-testid="input-pledged-items"
                  />
                  <Button
                    onClick={() => joinMutation.mutate()}
                    disabled={joinMutation.isPending}
                    className="w-full"
                    data-testid="button-request-join"
                  >
                    <Send className="h-4 w-4 mr-2" />
                    {joinMutation.isPending ? "Sending..." : "Request to Join"}
                  </Button>
                </div>
              )}
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}


================================================================
FILE: client/src/pages/create-party-page.tsx
================================================================
import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { useMutation } from "@tanstack/react-query";
import { useLocation, Link } from "wouter";
import { z } from "zod";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Badge } from "@/components/ui/badge";
import { Switch } from "@/components/ui/switch";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { ArrowLeft, Plus, X, PartyPopper } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { useToast } from "@/hooks/use-toast";
import { apiRequest } from "@/lib/queryClient";

const THEMES = [
  "Cyberpunk/Neon",
  "Cocktail/Lounge",
  "Pool Party",
  "Indie/Bohemian",
  "Festival/EDM",
  "House Party",
  "Other",
];

const COUNTRY_DATA: Record<string, string[]> = {
  "USA": ["New York", "Los Angeles", "Chicago", "Miami", "Austin", "San Francisco", "Seattle", "Denver"],
  "United Kingdom": ["London", "Manchester", "Birmingham", "Edinburgh", "Bristol", "Glasgow", "Liverpool"],
  "Germany": ["Berlin", "Munich", "Hamburg", "Cologne", "Frankfurt", "Stuttgart", "Dsseldorf"],
  "Romania": ["Bucharest", "Cluj-Napoca", "Timioara", "Iai", "Constana", "Braov", "Sibiu", "Vama Veche"],
};

const createPartySchema = z.object({
  title: z.string().min(1, "Title is required"),
  theme: z.string().min(1, "Theme is required"),
  description: z.string().min(1, "Description is required"),
  date: z.string().min(1, "Date is required"),
  time: z.string().min(1, "Time is required"),
  locationName: z.string().min(1, "Location name is required"),
  country: z.string().min(1, "Country is required"),
  city: z.string().min(1, "City is required"),
  exactAddress: z.string().optional(),
  maxGuests: z.number().min(1, "Must allow at least 1 guest"),
  price: z.number().min(0, "Price cannot be negative"),
  imageUrl: z.string().optional(),
  includesAlcohol: z.boolean(),
});

type CreatePartyForm = z.infer<typeof createPartySchema>;

export default function CreatePartyPage() {
  const { user } = useAuth();
  const { toast } = useToast();
  const [, setLocation] = useLocation();
  const [whatToBring, setWhatToBring] = useState<string[]>([]);
  const [bringItem, setBringItem] = useState("");

  const form = useForm<CreatePartyForm>({
    resolver: zodResolver(createPartySchema),
    defaultValues: {
      title: "",
      theme: "",
      description: "",
      date: "",
      time: "",
      locationName: "",
      country: "",
      city: "",
      exactAddress: "",
      maxGuests: 20,
      price: 0,
      imageUrl: "",
      includesAlcohol: false,
    },
  });

  const selectedCountry = form.watch("country");
  const cities = selectedCountry ? COUNTRY_DATA[selectedCountry] ?? [] : [];

  const createMutation = useMutation({
    mutationFn: async (values: CreatePartyForm) => {
      const dateTime = `${values.date} ${values.time}`;
      await apiRequest("POST", "/api/parties", {
        hostId: user?.id,
        title: values.title,
        theme: values.theme,
        description: values.description,
        date: dateTime,
        locationName: values.locationName,
        city: values.city,
        country: values.country,
        exactAddress: values.exactAddress || "",
        latitude: 40.7128,
        longitude: -73.9626,
        maxGuests: values.maxGuests,
        price: values.price,
        whatToBring,
        imageUrl: values.imageUrl || "/images/party-neon-techno.png",
        galleryUrls: [],
        includesAlcohol: values.includesAlcohol,
      });
    },
    onSuccess: () => {
      toast({ title: "Party created!", description: "Your party has been published." });
      setLocation("/host");
    },
    onError: (error: Error) => {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    },
  });

  function addBringItem() {
    const trimmed = bringItem.trim();
    if (trimmed && !whatToBring.includes(trimmed)) {
      setWhatToBring([...whatToBring, trimmed]);
      setBringItem("");
    }
  }

  function removeBringItem(item: string) {
    setWhatToBring(whatToBring.filter((i) => i !== item));
  }

  return (
    <div className="min-h-screen bg-background pb-28">
      <header className="sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div className="max-w-2xl mx-auto px-4 py-3 flex items-center gap-3">
          <Link href="/browse">
            <Button variant="ghost" size="icon" data-testid="button-back">
              <ArrowLeft className="h-5 w-5" />
            </Button>
          </Link>
          <div className="flex items-center gap-2">
            <PartyPopper className="h-5 w-5 text-primary" />
            <h1 className="text-lg font-bold">Create a Party</h1>
          </div>
        </div>
      </header>

      <main className="max-w-2xl mx-auto px-4 py-6">
        <Form {...form}>
          <form onSubmit={form.handleSubmit((v) => createMutation.mutate(v))} className="space-y-6">
            <Card>
              <CardHeader>
                <CardTitle className="text-base">Basic Info</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <FormField
                  control={form.control}
                  name="title"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Title</FormLabel>
                      <FormControl>
                        <Input placeholder="Give your party a name" {...field} data-testid="input-title" />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <FormField
                  control={form.control}
                  name="theme"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Theme</FormLabel>
                      <Select onValueChange={field.onChange} value={field.value}>
                        <FormControl>
                          <SelectTrigger data-testid="select-theme">
                            <SelectValue placeholder="Select a theme" />
                          </SelectTrigger>
                        </FormControl>
                        <SelectContent>
                          {THEMES.map((t) => (
                            <SelectItem key={t} value={t}>{t}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <FormField
                  control={form.control}
                  name="description"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Description</FormLabel>
                      <FormControl>
                        <Textarea
                          placeholder="Describe your party..."
                          className="min-h-[100px]"
                          {...field}
                          data-testid="input-description"
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="text-base">Date & Time</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <FormField
                    control={form.control}
                    name="date"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Date</FormLabel>
                        <FormControl>
                          <Input type="date" {...field} data-testid="input-date" />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                  <FormField
                    control={form.control}
                    name="time"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Time</FormLabel>
                        <FormControl>
                          <Input type="time" {...field} data-testid="input-time" />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="text-base">Location</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <FormField
                  control={form.control}
                  name="locationName"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Location Name</FormLabel>
                      <FormControl>
                        <Input placeholder="e.g. Williamsburg, Brooklyn" {...field} data-testid="input-location-name" />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <FormField
                    control={form.control}
                    name="country"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Country</FormLabel>
                        <Select
                          onValueChange={(val) => {
                            field.onChange(val);
                            form.setValue("city", "");
                          }}
                          value={field.value}
                        >
                          <FormControl>
                            <SelectTrigger data-testid="select-country">
                              <SelectValue placeholder="Select country" />
                            </SelectTrigger>
                          </FormControl>
                          <SelectContent>
                            {Object.keys(COUNTRY_DATA).map((c) => (
                              <SelectItem key={c} value={c}>{c}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="city"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>City</FormLabel>
                        <Select onValueChange={field.onChange} value={field.value} disabled={!selectedCountry}>
                          <FormControl>
                            <SelectTrigger data-testid="select-city">
                              <SelectValue placeholder="Select city" />
                            </SelectTrigger>
                          </FormControl>
                          <SelectContent>
                            {cities.map((c) => (
                              <SelectItem key={c} value={c}>{c}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>

                <FormField
                  control={form.control}
                  name="exactAddress"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Exact Address (optional)</FormLabel>
                      <FormControl>
                        <Input placeholder="Street address" {...field} data-testid="input-exact-address" />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="text-base">Details</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <FormField
                    control={form.control}
                    name="maxGuests"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Max Guests</FormLabel>
                        <FormControl>
                          <Input
                            type="number"
                            min={1}
                            {...field}
                            onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}
                            data-testid="input-max-guests"
                          />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="price"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Price ($)</FormLabel>
                        <FormControl>
                          <Input
                            type="number"
                            min={0}
                            {...field}
                            onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}
                            data-testid="input-price"
                          />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>

                <div className="space-y-2">
                  <FormLabel>What to Bring</FormLabel>
                  <div className="flex items-center gap-2">
                    <Input
                      placeholder="e.g. Drinks, Snacks"
                      value={bringItem}
                      onChange={(e) => setBringItem(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === "Enter") {
                          e.preventDefault();
                          addBringItem();
                        }
                      }}
                      data-testid="input-what-to-bring"
                    />
                    <Button type="button" variant="outline" onClick={addBringItem} data-testid="button-add-bring-item">
                      <Plus className="h-4 w-4" />
                    </Button>
                  </div>
                  {whatToBring.length > 0 && (
                    <div className="flex flex-wrap gap-2 pt-1">
                      {whatToBring.map((item) => (
                        <Badge key={item} variant="secondary" className="gap-1" data-testid={`badge-bring-${item}`}>
                          {item}
                          <button
                            type="button"
                            onClick={() => removeBringItem(item)}
                            className="ml-1"
                            data-testid={`button-remove-bring-${item}`}
                          >
                            <X className="h-3 w-3" />
                          </button>
                        </Badge>
                      ))}
                    </div>
                  )}
                </div>

                <FormField
                  control={form.control}
                  name="includesAlcohol"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between gap-2 rounded-md border p-3">
                      <FormLabel className="cursor-pointer">Includes Alcohol</FormLabel>
                      <FormControl>
                        <Switch
                          checked={field.value}
                          onCheckedChange={field.onChange}
                          data-testid="switch-includes-alcohol"
                        />
                      </FormControl>
                    </FormItem>
                  )}
                />

                <FormField
                  control={form.control}
                  name="imageUrl"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Party Image URL (optional)</FormLabel>
                      <FormControl>
                        <Input placeholder="/images/party-neon-techno.png" {...field} data-testid="input-image-url" />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            <Button
              type="submit"
              size="lg"
              className="w-full"
              disabled={createMutation.isPending}
              data-testid="button-publish-party"
            >
              {createMutation.isPending ? "Publishing..." : "Publish Party"}
            </Button>
          </form>
        </Form>
      </main>
    </div>
  );
}


================================================================
FILE: client/src/pages/host-page.tsx
================================================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { Link } from "wouter";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Skeleton } from "@/components/ui/skeleton";
import { Plus, Calendar, Users, MapPin, Check, X, MessageSquare, Gift, ChevronDown, ChevronUp, ArrowLeft, PartyPopper } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { useToast } from "@/hooks/use-toast";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { format } from "date-fns";
import type { Party } from "@shared/schema";

function formatPartyDate(dateStr: string) {
  try {
    return format(new Date(dateStr), "MMM d, yyyy 'at' h:mm a");
  } catch {
    return dateStr;
  }
}

interface RequestWithUser {
  id: string;
  partyId: string;
  userId: string;
  message: string;
  pledgedItems: string;
  status: string;
  user?: {
    id: string;
    fullName: string;
    avatar: string;
    nickname: string;
  };
}

function PartyRequestsList({ partyId }: { partyId: string }) {
  const { toast } = useToast();

  const { data: requests, isLoading } = useQuery<RequestWithUser[]>({
    queryKey: ["/api/parties", partyId, "requests"],
  });

  const updateStatusMutation = useMutation({
    mutationFn: async ({ requestId, status }: { requestId: string; status: string }) => {
      await apiRequest("PATCH", `/api/requests/${requestId}/status`, { status });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/parties", partyId, "requests"] });
      queryClient.invalidateQueries({ queryKey: ["/api/parties/host/mine"] });
      toast({ title: "Request updated" });
    },
    onError: (error: Error) => {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    },
  });

  const pendingRequests = requests?.filter((r) => r.status === "pending") ?? [];

  if (isLoading) {
    return (
      <div className="space-y-3 pt-3">
        {Array.from({ length: 2 }).map((_, i) => (
          <div key={i} className="flex items-center gap-3">
            <Skeleton className="h-10 w-10 rounded-full" />
            <div className="flex-1 space-y-1">
              <Skeleton className="h-4 w-24" />
              <Skeleton className="h-3 w-40" />
            </div>
          </div>
        ))}
      </div>
    );
  }

  if (pendingRequests.length === 0) {
    return (
      <p className="text-sm text-muted-foreground pt-3" data-testid="text-no-pending-requests">
        No pending requests
      </p>
    );
  }

  return (
    <div className="space-y-3 pt-3">
      {pendingRequests.map((req) => (
        <div
          key={req.id}
          className="flex items-start gap-3 rounded-md border p-3"
          data-testid={`card-request-${req.id}`}
        >
          <Avatar>
            <AvatarImage src={req.user?.avatar} />
            <AvatarFallback>{(req.user?.fullName || "?")[0]}</AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0 space-y-1">
            <p className="font-medium text-sm" data-testid={`text-requester-name-${req.id}`}>
              {req.user?.fullName || req.user?.nickname || "Unknown"}
            </p>
            {req.message && (
              <div className="flex items-start gap-1.5 text-sm text-muted-foreground">
                <MessageSquare className="h-3.5 w-3.5 shrink-0 mt-0.5" />
                <span className="line-clamp-2">{req.message}</span>
              </div>
            )}
            {req.pledgedItems && (
              <div className="flex items-start gap-1.5 text-sm text-muted-foreground">
                <Gift className="h-3.5 w-3.5 shrink-0 mt-0.5" />
                <span>{req.pledgedItems}</span>
              </div>
            )}
          </div>
          <div className="flex items-center gap-1 shrink-0">
            <Button
              size="icon"
              variant="ghost"
              onClick={() => updateStatusMutation.mutate({ requestId: req.id, status: "accepted" })}
              disabled={updateStatusMutation.isPending}
              data-testid={`button-accept-request-${req.id}`}
            >
              <Check className="h-4 w-4 text-green-500" />
            </Button>
            <Button
              size="icon"
              variant="ghost"
              onClick={() => updateStatusMutation.mutate({ requestId: req.id, status: "declined" })}
              disabled={updateStatusMutation.isPending}
              data-testid={`button-decline-request-${req.id}`}
            >
              <X className="h-4 w-4 text-red-500" />
            </Button>
          </div>
        </div>
      ))}
    </div>
  );
}

function HostedPartyCard({ party }: { party: Party & { attendeeCount?: number } }) {
  const [expanded, setExpanded] = useState(false);

  return (
    <Card className="overflow-visible" data-testid={`card-hosted-party-${party.id}`}>
      <div className="flex gap-4 p-4">
        <div className="w-24 h-24 rounded-md overflow-hidden shrink-0">
          <img
            src={party.imageUrl || "/images/party-house.png"}
            alt={party.title}
            className="w-full h-full object-cover"
          />
        </div>
        <div className="flex-1 min-w-0 space-y-1">
          <h3 className="font-semibold leading-tight line-clamp-1" data-testid={`text-party-title-${party.id}`}>
            {party.title}
          </h3>
          <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
            <Calendar className="h-3.5 w-3.5 shrink-0" />
            <span className="truncate">{formatPartyDate(party.date)}</span>
          </div>
          <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
            <MapPin className="h-3.5 w-3.5 shrink-0" />
            <span className="truncate">{party.locationName}, {party.city}</span>
          </div>
          <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
            <Users className="h-3.5 w-3.5 shrink-0" />
            <span>{party.attendeeCount ?? 0}/{party.maxGuests} guests</span>
          </div>
        </div>
      </div>
      <div className="border-t px-4 py-2">
        <Button
          variant="ghost"
          className="w-full justify-between"
          onClick={() => setExpanded(!expanded)}
          data-testid={`button-toggle-requests-${party.id}`}
        >
          <span className="text-sm">Join Requests</span>
          {expanded ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
        </Button>
        {expanded && (
          <div className="pb-3">
            <PartyRequestsList partyId={party.id} />
          </div>
        )}
      </div>
    </Card>
  );
}

function HostPageSkeleton() {
  return (
    <div className="space-y-4">
      {Array.from({ length: 3 }).map((_, i) => (
        <Card key={i} className="overflow-visible">
          <div className="flex gap-4 p-4">
            <Skeleton className="w-24 h-24 rounded-md" />
            <div className="flex-1 space-y-2">
              <Skeleton className="h-5 w-3/4" />
              <Skeleton className="h-4 w-1/2" />
              <Skeleton className="h-4 w-2/3" />
            </div>
          </div>
        </Card>
      ))}
    </div>
  );
}

export default function HostPage() {
  const { user } = useAuth();

  const { data: parties, isLoading } = useQuery<(Party & { attendeeCount?: number })[]>({
    queryKey: ["/api/parties/host/mine"],
  });

  return (
    <div className="min-h-screen bg-background pb-28">
      <header className="sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div className="max-w-2xl mx-auto px-4 py-3 flex items-center justify-between gap-3 flex-wrap">
          <div className="flex items-center gap-3">
            <Link href="/browse">
              <Button variant="ghost" size="icon" data-testid="button-back">
                <ArrowLeft className="h-5 w-5" />
              </Button>
            </Link>
            <h1 className="text-lg font-bold">My Hosted Parties</h1>
          </div>
          <Link href="/create-party">
            <Button data-testid="button-create-party">
              <Plus className="h-4 w-4 mr-2" />
              Create Party
            </Button>
          </Link>
        </div>
      </header>

      <main className="max-w-2xl mx-auto px-4 py-6 space-y-4">
        {isLoading ? (
          <HostPageSkeleton />
        ) : !parties || parties.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-20 text-center" data-testid="text-empty-state">
            <PartyPopper className="h-12 w-12 text-muted-foreground mb-4" />
            <h2 className="text-xl font-semibold mb-2">No parties yet</h2>
            <p className="text-muted-foreground mb-6">Create your first party and start hosting!</p>
            <Link href="/create-party">
              <Button data-testid="button-create-party-empty">
                <Plus className="h-4 w-4 mr-2" />
                Create a Party
              </Button>
            </Link>
          </div>
        ) : (
          parties.map((party) => (
            <HostedPartyCard key={party.id} party={party} />
          ))
        )}
      </main>
    </div>
  );
}


================================================================
FILE: client/src/pages/attending-page.tsx
================================================================
import { useQuery } from "@tanstack/react-query";
import { Link } from "wouter";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import { Calendar, MapPin, Users, PartyPopper, DollarSign, ArrowLeft } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { format } from "date-fns";
import type { Party } from "@shared/schema";

interface AttendingParty extends Party {
  hostName?: string;
  attendeeCount?: number;
}

function formatPartyDate(dateStr: string) {
  try {
    return format(new Date(dateStr), "MMM d, yyyy 'at' h:mm a");
  } catch {
    return dateStr;
  }
}

function AttendingCardSkeleton() {
  return (
    <Card className="overflow-visible">
      <div className="flex gap-4 p-4">
        <Skeleton className="w-24 h-24 rounded-md" />
        <div className="flex-1 space-y-2">
          <Skeleton className="h-5 w-3/4" />
          <Skeleton className="h-4 w-1/2" />
          <Skeleton className="h-4 w-2/3" />
          <Skeleton className="h-4 w-1/3" />
        </div>
      </div>
    </Card>
  );
}

export default function AttendingPage() {
  const { user } = useAuth();

  const { data: parties, isLoading } = useQuery<AttendingParty[]>({
    queryKey: ["/api/parties/attending/mine"],
  });

  return (
    <div className="min-h-screen bg-background pb-28">
      <header className="sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div className="max-w-2xl mx-auto px-4 py-3 flex items-center gap-3">
          <Link href="/browse">
            <Button variant="ghost" size="icon" data-testid="button-back">
              <ArrowLeft className="h-5 w-5" />
            </Button>
          </Link>
          <h1 className="text-lg font-bold">Attending</h1>
        </div>
      </header>

      <main className="max-w-2xl mx-auto px-4 py-6 space-y-4">
        {isLoading ? (
          <div className="space-y-4">
            {Array.from({ length: 3 }).map((_, i) => (
              <AttendingCardSkeleton key={i} />
            ))}
          </div>
        ) : !parties || parties.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-20 text-center" data-testid="text-empty-state">
            <PartyPopper className="h-12 w-12 text-muted-foreground mb-4" />
            <h2 className="text-xl font-semibold mb-2">No parties yet</h2>
            <p className="text-muted-foreground mb-6">Browse parties and request to join!</p>
            <Link href="/browse">
              <Button data-testid="button-browse-parties">Browse Parties</Button>
            </Link>
          </div>
        ) : (
          parties.map((party) => (
            <Link key={party.id} href={`/party/${party.id}`} data-testid={`link-party-${party.id}`}>
              <Card className="overflow-visible hover-elevate cursor-pointer">
                <div className="flex gap-4 p-4">
                  <div className="w-24 h-24 rounded-md overflow-hidden shrink-0">
                    <img
                      src={party.imageUrl || "/images/party-house.png"}
                      alt={party.title}
                      className="w-full h-full object-cover"
                    />
                  </div>
                  <div className="flex-1 min-w-0 space-y-1">
                    <h3 className="font-semibold leading-tight line-clamp-1" data-testid={`text-party-title-${party.id}`}>
                      {party.title}
                    </h3>
                    <Badge variant="secondary" className="text-xs" data-testid={`badge-theme-${party.id}`}>
                      {party.theme}
                    </Badge>
                    <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                      <Calendar className="h-3.5 w-3.5 shrink-0" />
                      <span className="truncate">{formatPartyDate(party.date)}</span>
                    </div>
                    <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                      <MapPin className="h-3.5 w-3.5 shrink-0" />
                      <span className="truncate">{party.locationName}, {party.city}</span>
                    </div>
                    <div className="flex items-center gap-3 flex-wrap">
                      <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                        <Users className="h-3.5 w-3.5" />
                        <span>{party.attendeeCount ?? 0}/{party.maxGuests}</span>
                      </div>
                      <span className="text-sm font-medium" data-testid={`text-price-${party.id}`}>
                        {(party.price ?? 0) === 0 ? "FREE" : `$${party.price}`}
                      </span>
                    </div>
                    {party.hostName && (
                      <p className="text-xs text-muted-foreground">Hosted by {party.hostName}</p>
                    )}
                  </div>
                </div>
              </Card>
            </Link>
          ))
        )}
      </main>
    </div>
  );
}


================================================================
FILE: client/src/pages/profile-page.tsx
================================================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { useLocation } from "wouter";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Skeleton } from "@/components/ui/skeleton";
import { Separator } from "@/components/ui/separator";
import { Star, ShieldCheck, Settings, LogOut, Award, UserCheck } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { useToast } from "@/hooks/use-toast";
import type { Review } from "@shared/schema";

function RatingStars({ rating }: { rating: number }) {
  return (
    <div className="flex items-center gap-0.5">
      {[...Array(5)].map((_, i) => (
        <Star
          key={i}
          size={14}
          className={i < Math.floor(rating) ? "fill-yellow-500 text-yellow-500" : "text-muted-foreground"}
        />
      ))}
      <span className="text-sm text-muted-foreground ml-1">{rating.toFixed(1)}</span>
    </div>
  );
}

function getInitials(name: string) {
  return name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2);
}

export default function ProfilePage() {
  const [, setLocation] = useLocation();
  const { user, isLoading, logout } = useAuth();
  const { toast } = useToast();
  const [reviewTab, setReviewTab] = useState("host");

  const { data: reviews = [], isLoading: reviewsLoading } = useQuery<Review[]>({
    queryKey: ["/api/users", user?.id, "reviews"],
    enabled: !!user?.id,
  });

  const hostReviews = reviews.filter((r) => r.type === "host");
  const guestReviews = reviews.filter((r) => r.type === "guest");

  if (isLoading || !user) {
    return (
      <div className="min-h-screen bg-background p-4">
        <div className="max-w-lg mx-auto space-y-4">
          <Skeleton className="h-32 w-full rounded-md" />
          <Skeleton className="h-24 w-full rounded-md" />
          <Skeleton className="h-48 w-full rounded-md" />
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background text-foreground p-4 pb-28">
      <div className="max-w-lg mx-auto space-y-4">
        <Card>
          <CardContent className="p-6">
            <div className="flex flex-col items-center text-center gap-3">
              <Avatar className="h-24 w-24" data-testid="img-avatar">
                <AvatarImage src={user.avatar || undefined} alt={user.fullName} />
                <AvatarFallback className="text-2xl">{getInitials(user.fullName)}</AvatarFallback>
              </Avatar>
              <div className="space-y-1">
                <div className="flex items-center justify-center gap-2 flex-wrap">
                  <h1 className="text-xl font-semibold" data-testid="text-fullname">{user.fullName}</h1>
                  {user.isIdVerified && (
                    <Badge variant="secondary" className="gap-1" data-testid="badge-verified">
                      <ShieldCheck size={12} />
                      Verified
                    </Badge>
                  )}
                </div>
                <p className="text-sm text-muted-foreground" data-testid="text-username">@{user.username}</p>
              </div>
              {user.bio && (
                <p className="text-sm text-muted-foreground max-w-sm" data-testid="text-bio">{user.bio}</p>
              )}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="grid grid-cols-3 gap-4 text-center">
              <div className="space-y-1">
                <div className="flex items-center justify-center gap-1">
                  <Star size={16} className="fill-yellow-500 text-yellow-500" />
                  <span className="font-semibold" data-testid="text-host-rating">
                    {(user.hostRating ?? 0).toFixed(1)}
                  </span>
                </div>
                <p className="text-xs text-muted-foreground">Host Rating</p>
              </div>
              <div className="space-y-1">
                <div className="flex items-center justify-center gap-1">
                  <Star size={16} className="fill-yellow-500 text-yellow-500" />
                  <span className="font-semibold" data-testid="text-guest-rating">
                    {(user.guestRating ?? 0).toFixed(1)}
                  </span>
                </div>
                <p className="text-xs text-muted-foreground">Guest Rating</p>
              </div>
              <div className="space-y-1">
                <span className="font-semibold" data-testid="text-review-count">{reviews.length}</span>
                <p className="text-xs text-muted-foreground">Reviews</p>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-base">Reviews</CardTitle>
          </CardHeader>
          <CardContent className="p-4 pt-0">
            <Tabs value={reviewTab} onValueChange={setReviewTab}>
              <TabsList className="w-full" data-testid="tabs-reviews">
                <TabsTrigger value="host" className="flex-1" data-testid="tab-as-host">As Host</TabsTrigger>
                <TabsTrigger value="guest" className="flex-1" data-testid="tab-as-guest">As Guest</TabsTrigger>
              </TabsList>

              <TabsContent value="host" className="mt-3 space-y-3">
                {reviewsLoading ? (
                  <div className="space-y-3">
                    <Skeleton className="h-20 w-full" />
                    <Skeleton className="h-20 w-full" />
                  </div>
                ) : hostReviews.length === 0 ? (
                  <div className="text-center py-6">
                    <Award size={32} className="mx-auto text-muted-foreground mb-2" />
                    <p className="text-sm text-muted-foreground" data-testid="text-no-host-reviews">No host reviews yet</p>
                  </div>
                ) : (
                  hostReviews.map((review) => (
                    <ReviewCard key={review.id} review={review} />
                  ))
                )}
              </TabsContent>

              <TabsContent value="guest" className="mt-3 space-y-3">
                {reviewsLoading ? (
                  <div className="space-y-3">
                    <Skeleton className="h-20 w-full" />
                    <Skeleton className="h-20 w-full" />
                  </div>
                ) : guestReviews.length === 0 ? (
                  <div className="text-center py-6">
                    <UserCheck size={32} className="mx-auto text-muted-foreground mb-2" />
                    <p className="text-sm text-muted-foreground" data-testid="text-no-guest-reviews">No guest reviews yet</p>
                  </div>
                ) : (
                  guestReviews.map((review) => (
                    <ReviewCard key={review.id} review={review} />
                  ))
                )}
              </TabsContent>
            </Tabs>
          </CardContent>
        </Card>

        <div className="space-y-2">
          <Button
            className="w-full"
            onClick={() => setLocation("/settings")}
            data-testid="button-edit-profile"
          >
            <Settings size={16} className="mr-2" />
            Edit Profile
          </Button>

          {!user.isIdVerified && (
            <Button
              variant="outline"
              className="w-full"
              onClick={() =>
                toast({
                  title: "Coming Soon",
                  description: "ID verification coming soon",
                })
              }
              data-testid="button-verify-id"
            >
              <ShieldCheck size={16} className="mr-2" />
              Verify ID
            </Button>
          )}

          <Button
            variant="outline"
            className="w-full"
            onClick={() => logout()}
            data-testid="button-logout"
          >
            <LogOut size={16} className="mr-2" />
            Log Out
          </Button>
        </div>
      </div>
    </div>
  );
}

function ReviewCard({ review }: { review: Review }) {
  return (
    <Card data-testid={`card-review-${review.id}`}>
      <CardContent className="p-4">
        <div className="flex items-start gap-3">
          <Avatar className="h-8 w-8 shrink-0">
            <AvatarFallback className="text-xs">
              {review.authorId.slice(0, 2).toUpperCase()}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0 space-y-1">
            <div className="flex items-center justify-between gap-2 flex-wrap">
              <RatingStars rating={review.rating} />
              {review.createdAt && (
                <span className="text-xs text-muted-foreground" data-testid={`text-review-date-${review.id}`}>
                  {new Date(review.createdAt).toLocaleDateString()}
                </span>
              )}
            </div>
            <p className="text-sm" data-testid={`text-review-content-${review.id}`}>{review.content}</p>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


================================================================
FILE: client/src/pages/settings-page.tsx
================================================================
import { useState, useEffect } from "react";
import { useMutation } from "@tanstack/react-query";
import { useLocation } from "wouter";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Switch } from "@/components/ui/switch";
import { Slider } from "@/components/ui/slider";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Separator } from "@/components/ui/separator";
import { Skeleton } from "@/components/ui/skeleton";
import { ArrowLeft, Save, LogOut } from "lucide-react";
import { useAuth } from "@/hooks/use-auth";
import { useTheme } from "@/components/theme-provider";
import { useToast } from "@/hooks/use-toast";
import { apiRequest, queryClient } from "@/lib/queryClient";

const COUNTRY_DATA: Record<string, string[]> = {
  "USA": ["New York", "Los Angeles", "Chicago", "Miami", "Austin", "San Francisco", "Seattle", "Denver"],
  "United Kingdom": ["London", "Manchester", "Birmingham", "Edinburgh", "Bristol", "Glasgow", "Liverpool"],
  "Germany": ["Berlin", "Munich", "Hamburg", "Cologne", "Frankfurt", "Stuttgart", "Dsseldorf"],
  "Romania": ["Bucharest", "Cluj-Napoca", "Timioara", "Iai", "Constana", "Braov", "Sibiu", "Vama Veche"],
};

export default function SettingsPage() {
  const [, setLocation] = useLocation();
  const { user, isLoading, logout } = useAuth();
  const { theme, setTheme } = useTheme();
  const { toast } = useToast();

  const [fullName, setFullName] = useState("");
  const [nickname, setNickname] = useState("");
  const [email, setEmail] = useState("");
  const [phone, setPhone] = useState("");
  const [bio, setBio] = useState("");

  const [country, setCountry] = useState("");
  const [city, setCity] = useState("");
  const [address, setAddress] = useState("");

  const [notifications, setNotifications] = useState(true);
  const [darkMode, setDarkMode] = useState(false);
  const [searchRadius, setSearchRadius] = useState(50);

  useEffect(() => {
    if (user) {
      setFullName(user.fullName || "");
      setNickname(user.nickname || "");
      setEmail(user.email || "");
      setPhone(user.phone || "");
      setBio(user.bio || "");
      setCountry(user.country || "");
      setCity(user.city || "");
      setAddress(user.address || "");
      setNotifications(user.notificationsEnabled ?? true);
      setDarkMode(user.darkMode ?? false);
      setSearchRadius(user.searchRadius ?? 50);
    }
  }, [user]);

  const updateMutation = useMutation({
    mutationFn: async (data: Record<string, unknown>) => {
      const res = await apiRequest("PATCH", `/api/users/${user!.id}`, data);
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/auth/me"] });
      toast({ title: "Saved", description: "Your changes have been saved." });
    },
    onError: () => {
      toast({ title: "Error", description: "Failed to save changes.", variant: "destructive" });
    },
  });

  const cities = country ? COUNTRY_DATA[country] || [] : [];

  if (isLoading) {
    return (
      <div className="min-h-screen bg-background p-4">
        <div className="max-w-lg mx-auto space-y-4">
          <Skeleton className="h-8 w-32" />
          <Skeleton className="h-48 w-full rounded-md" />
          <Skeleton className="h-48 w-full rounded-md" />
        </div>
      </div>
    );
  }

  if (!user) {
    return null;
  }

  return (
    <div className="min-h-screen bg-background text-foreground p-4 pb-28">
      <div className="max-w-lg mx-auto space-y-4">
        <Button
          variant="ghost"
          onClick={() => setLocation("/profile")}
          data-testid="button-back"
        >
          <ArrowLeft size={16} className="mr-2" />
          Back to Profile
        </Button>

        <h1 className="text-xl font-semibold" data-testid="text-settings-title">Settings</h1>

        <Card>
          <CardHeader>
            <CardTitle className="text-base">Personal Info</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="fullName">Full Name</Label>
              <Input
                id="fullName"
                value={fullName}
                onChange={(e) => setFullName(e.target.value)}
                data-testid="input-fullname"
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="nickname">Nickname</Label>
              <Input
                id="nickname"
                value={nickname}
                onChange={(e) => setNickname(e.target.value)}
                data-testid="input-nickname"
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                data-testid="input-email"
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="phone">Phone</Label>
              <Input
                id="phone"
                value={phone}
                onChange={(e) => setPhone(e.target.value)}
                data-testid="input-phone"
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="bio">Bio</Label>
              <Textarea
                id="bio"
                value={bio}
                onChange={(e) => setBio(e.target.value)}
                rows={3}
                data-testid="input-bio"
              />
            </div>
            <Button
              onClick={() =>
                updateMutation.mutate({ fullName, nickname, email, phone, bio })
              }
              disabled={updateMutation.isPending}
              data-testid="button-save-personal"
            >
              <Save size={16} className="mr-2" />
              {updateMutation.isPending ? "Saving..." : "Save Personal Info"}
            </Button>
          </CardContent>
        </Card>

        <Separator />

        <Card>
          <CardHeader>
            <CardTitle className="text-base">Location</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label>Country</Label>
              <Select
                value={country}
                onValueChange={(val) => {
                  setCountry(val);
                  setCity("");
                }}
              >
                <SelectTrigger data-testid="select-country">
                  <SelectValue placeholder="Select country" />
                </SelectTrigger>
                <SelectContent>
                  {Object.keys(COUNTRY_DATA).map((c) => (
                    <SelectItem key={c} value={c} data-testid={`option-country-${c}`}>
                      {c}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label>City</Label>
              <Select value={city} onValueChange={setCity} disabled={!country}>
                <SelectTrigger data-testid="select-city">
                  <SelectValue placeholder="Select city" />
                </SelectTrigger>
                <SelectContent>
                  {cities.map((c) => (
                    <SelectItem key={c} value={c} data-testid={`option-city-${c}`}>
                      {c}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label htmlFor="address">Address</Label>
              <Input
                id="address"
                value={address}
                onChange={(e) => setAddress(e.target.value)}
                data-testid="input-address"
              />
            </div>
            <Button
              onClick={() => updateMutation.mutate({ country, city, address })}
              disabled={updateMutation.isPending}
              data-testid="button-save-location"
            >
              <Save size={16} className="mr-2" />
              {updateMutation.isPending ? "Saving..." : "Save Location"}
            </Button>
          </CardContent>
        </Card>

        <Separator />

        <Card>
          <CardHeader>
            <CardTitle className="text-base">Preferences</CardTitle>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="flex items-center justify-between gap-4">
              <div>
                <Label>Notifications</Label>
                <p className="text-xs text-muted-foreground">Receive push notifications</p>
              </div>
              <Switch
                checked={notifications}
                onCheckedChange={setNotifications}
                data-testid="switch-notifications"
              />
            </div>
            <div className="flex items-center justify-between gap-4">
              <div>
                <Label>Dark Mode</Label>
                <p className="text-xs text-muted-foreground">Toggle dark theme</p>
              </div>
              <Switch
                checked={theme === "dark"}
                onCheckedChange={(checked) => {
                  setTheme(checked ? "dark" : "light");
                  setDarkMode(checked);
                }}
                data-testid="switch-dark-mode"
              />
            </div>
            <div className="space-y-3">
              <div className="flex items-center justify-between gap-4">
                <Label>Search Radius</Label>
                <span className="text-sm text-muted-foreground" data-testid="text-search-radius">
                  {searchRadius} km
                </span>
              </div>
              <Slider
                value={[searchRadius]}
                onValueChange={(val) => setSearchRadius(val[0])}
                min={5}
                max={200}
                step={5}
                data-testid="slider-search-radius"
              />
            </div>
            <Button
              onClick={() =>
                updateMutation.mutate({
                  notificationsEnabled: notifications,
                  darkMode,
                  searchRadius,
                })
              }
              disabled={updateMutation.isPending}
              data-testid="button-save-preferences"
            >
              <Save size={16} className="mr-2" />
              {updateMutation.isPending ? "Saving..." : "Save Preferences"}
            </Button>
          </CardContent>
        </Card>

        <Separator />

        <Card>
          <CardHeader>
            <CardTitle className="text-base">Account</CardTitle>
          </CardHeader>
          <CardContent>
            <Button
              variant="outline"
              className="w-full"
              onClick={() => logout()}
              data-testid="button-logout"
            >
              <LogOut size={16} className="mr-2" />
              Log Out
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


================================================================
FILE: client/src/pages/not-found.tsx
================================================================
import { Card, CardContent } from "@/components/ui/card";
import { AlertCircle } from "lucide-react";

export default function NotFound() {
  return (
    <div className="min-h-screen w-full flex items-center justify-center bg-gray-50">
      <Card className="w-full max-w-md mx-4">
        <CardContent className="pt-6">
          <div className="flex mb-4 gap-2">
            <AlertCircle className="h-8 w-8 text-red-500" />
            <h1 className="text-2xl font-bold text-gray-900">404 Page Not Found</h1>
          </div>

          <p className="mt-4 text-sm text-gray-600">
            Did you forget to add the page to the router?
          </p>
        </CardContent>
      </Card>
    </div>
  );
}


